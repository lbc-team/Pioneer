
>- åŸæ–‡é“¾æ¥ï¼šhttps://medium.com/cyfrin/where-can-the-evm-read-write-data-fixing-data-location-must-be-memory-or-calldata-ebdf87d5dcb8
>- è¯‘è€…ï¼š[AIç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œæ ¡å¯¹ï¼š[ç¿»è¯‘å°ç»„](https://learnblockchain.cn/people/412)
>- æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[learnblockchain.cn/articleâ€¦](https://learnblockchain.cn/article/9475)
    
# EVM å®é™…ä¸Šèƒ½åšä»€ä¹ˆï¼Ÿ

![ä½ å¯ä»¥åœ¨ EVM ä¸­è¯»å–å’Œå†™å…¥æ•°æ®çš„ä½ç½®](https://miro.medium.com/v2/resize:fit:1400/0*W5rxjWHYVPeWt86w)

ä½ å¯ä»¥åœ¨ EVM ä¸­è¯»å–å’Œå†™å…¥æ•°æ®çš„ä½ç½® (2024 å¹´ 6 æœˆ)

**æœ¬æ–‡æœ€åˆå‘è¡¨äº** [_Cyfrin åšå®¢_](https://www.cyfrin.io/blog/fixing-data-location-must-be-memory-or-calldata)_ã€‚_

# ä»€ä¹ˆæ˜¯ EVMï¼Ÿ

EVM ä»£è¡¨â€œä»¥å¤ªåŠè™šæ‹Ÿæœºâ€ã€‚æ¯å½“ä½ åœ¨ä»¥å¤ªåŠï¼ˆæˆ–å…¶ä»– EVM é“¾ï¼‰ä¸Šâ€œåšâ€ä»»ä½•äº‹æƒ…æ—¶ï¼Œè¿è¡Œ EVM è½¯ä»¶çš„ä¸åŒèŠ‚ç‚¹ä¼šåœ¨å…¶ä¸­å¯åŠ¨ä¸€å°è™šæ‹Ÿæœºå™¨ï¼ˆç§°ä¸ºè™šæ‹Ÿæœºï¼‰å¹¶è¿è¡Œæœºå™¨çº§ä»£ç ã€‚

æœºå™¨çº§ä»£ç æœ‰æ—¶è¢«ç§°ä¸ºâ€œæ±‡ç¼–â€ã€â€œæ“ä½œç â€æˆ–åœ¨å…¶æœ€ä½çº§åˆ«ç§°ä¸ºâ€œåå…­è¿›åˆ¶â€ã€‚

è¿™ä¸²åå…­è¿›åˆ¶ï¼š

0x6080604052

æ˜¯ä¸€ç»„æœºå™¨æŒ‡ä»¤ï¼Œè½¬æ¢ä¸ºï¼š

PUSH1 0x80          
PUSH1 0x40          
MSTORE            

è¿™äº›éƒ½æ˜¯ EVM æ“ä½œç ã€‚æ­£æ˜¯è¿™ç»„æ“ä½œç æ§åˆ¶æ¯ä¸ª EVM / ä»¥å¤ªåŠèŠ‚ç‚¹å¯ä»¥â€œåšâ€ä»€ä¹ˆã€‚åœ¨æˆ‘ä»¬çš„ Solidity æ™ºèƒ½åˆçº¦ä¸­ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘ä¸ºè¿™äº›æ“ä½œç ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹ Solidity ä»£ç ï¼š

// SPDX-License-Identifier: MIT  
  
pragma solidity 0.8.24;  
  
contract Hi {  
    function hi() public pure returns(uint256){  
        return 7;  
    }  
}

ç¼–è¯‘ä¸ºï¼š

0x608060405234801561000f575f80fd5b5060af8061001c5f395ff3fe6080604052348015600e575f80fd5b50600436106026575f3560e01c8063a99dca3f14602a575b5f80fd5b60306044565b604051603b91906062565b60405180910390f35b5f6007905090565b5f819050919050565b605c81604c565b82525050565b5f60208201905060735f8301846055565b9291505056fea264697066735822122020880945bedabcb839ddd572248fb2e38887216fb2a960d7f7f07c0bd9071fe864736f6c63430008180033

æ­£æ˜¯è¿™äº›å­—èŠ‚ç å†³å®šäº†æˆ‘ä»¬å¦‚ä½•ä¸ä»£ç åº“äº¤äº’ã€‚

æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ EVM èƒ½åšä»€ä¹ˆï¼Œå®ƒå¯ä»¥è¯»å–å’Œå†™å…¥åˆ°å“ªé‡Œï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨è¿™ä¸€ç‚¹ä½œä¸ºå¼€å‘äººå‘˜ã€‚

# æ–‡ç« å‰ææ¡ä»¶

è¦çœŸæ­£ç†è§£æœ¬æ–‡ï¼Œæˆ‘ä»¬å»ºè®®ä½ é¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯[ä½å’Œå­—èŠ‚](https://www.youtube.com/watch?v=Dnd28lQHquU) ã€‚

# EVM ä¸­å¸¸è§çš„ Solidity é”™è¯¯

ä½ å¯èƒ½åœ¨ Solidity ä¸­è§è¿‡è¿™ä¸ªé”™è¯¯ï¼š

function doStuff(string stuff) public {  
// ä¸Šè¿°ä»£ç å°†æ— æ³•ç¼–è¯‘ï¼ŒæŠ›å‡ºé”™è¯¯ï¼š  
// TypeError: Data location must be "memory" or "calldata" for parameter in  
// function, but none was given

å¹¶ä¸”å®ƒå°†æ— æ³•ç¼–è¯‘ï¼Œé”™è¯¯ä¸ºï¼š

TypeError: Data location must be memory or calldata for parameter in function,   
but none was given

ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

ä»€ä¹ˆæ˜¯ memory æˆ– calldataï¼Ÿ

æœ€åï¼Œä¸ºä»€ä¹ˆè¿™å¼ å›¾ç‰‡ä»£è¡¨ EVMï¼Ÿ

![EVM å¸ƒå±€](https://miro.medium.com/v2/resize:fit:1400/0*1gVvYksZJ7MWmgAn)

**åŸå§‹å›¾ç‰‡æ¥è‡ª** [_@pcaversaccio_](https://x.com/pcaversaccio/status/1651926715931738112/photo/2)

å¦‚æœä½ æƒ³å…¨é¢äº†è§£åº•å±‚å‘ç”Ÿçš„äº‹æƒ…ï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹ [Cyfrin Updraft Assembly and Formal Verification è¯¾ç¨‹](https://updraft.cyfrin.io/courses/formal-verification/)ï¼Œè¯¥è¯¾ç¨‹æ¯”æˆ‘ä»¬åœ¨æ­¤å¤„æ¶µç›–çš„å†…å®¹æ›´æ·±å…¥ã€‚

[evm.codes](https://www.evm.codes/) ç½‘ç«™åœ¨è·Ÿè¸ª EVM æ“ä½œç åŠå…¶åŠŸèƒ½æ–¹é¢åšå¾—å¾ˆå¥½ã€‚

_è¯·æ³¨æ„ï¼ŒEVM æ­£åœ¨ä¸æ–­æ”¹è¿›ï¼Œæ­¤ä¿¡æ¯æˆªè‡³ 2024 å¹´ 6 æœˆ 3 æ—¥æ˜¯å‡†ç¡®çš„ã€‚å¦‚æœæŸäº›å†…å®¹çœ‹èµ·æ¥è¿‡æ—¶ï¼Œè¯·åœ¨ Twitter ä¸Šè”ç³» @_[_cyfrinupdraft_](https://x.com/CyfrinUpdraft) _æˆ– @_[_patrickalphac_](https://x.com/PatrickAlphaC) _ã€‚_

è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ã€‚

# EVM å¯ä»¥è®¿é—®æ•°æ®çš„ä½ç½®

EVM å¯ä»¥ä»ä»¥ä¸‹ä½ç½®**è¯»å–å’Œå†™å…¥**æ•°æ®ï¼š

*   æ ˆ
*   å†…å­˜
*   å­˜å‚¨
*   ç¬æ€å­˜å‚¨
*   è°ƒç”¨æ•°æ®
*   ä»£ç 
*   è¿”å›æ•°æ®

EVM å¯ä»¥**å†™å…¥ä½†ä¸èƒ½è¯»å–**æ•°æ®åˆ°ä»¥ä¸‹ä½ç½®ï¼š

*   æ—¥å¿—

EVM å¯ä»¥**è¯»å–ä½†ä¸èƒ½å†™å…¥**æ•°æ®ä»ä»¥ä¸‹ä½ç½®ï¼š

*   äº¤æ˜“æ•°æ®
*   é“¾æ•°æ®
*   Gas æ•°æ®
*   å…¶ä»–ä¸€äº›è¶…ç‰¹å®šä½ç½®

# æ ˆ

![EVM å¯ä»¥è¯»å–å’Œå†™å…¥æ•°æ®çš„ä½ç½®](https://miro.medium.com/v2/resize:fit:1400/0*DGFX-Zu5kiFU4gYo)

EVMï¼šæ ˆ

EVM ä¸–ç•Œä¸­çš„[æ ˆ](https://en.wikipedia.org/wiki/Stack_\(abstract_data_type\) )æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå…¶ä¸­é¡¹ç›®åªèƒ½ä»é¡¶éƒ¨æ·»åŠ æˆ–ç§»é™¤ã€‚å®ƒæœ‰ä¸¤ä¸ªä¸»è¦æ“ä½œï¼š

*   `push`ï¼šæ·»åŠ åˆ°æ ˆé¡¶
*   `pop`ï¼šä»æ ˆé¡¶ç§»é™¤

ğŸ¥åœ¨è¿™æ–¹é¢ï¼Œä½ å¯ä»¥å°†æ ˆæƒ³è±¡æˆä¸€å ç…é¥¼ã€‚

å¤§å¤šæ•°æ—¶å€™ï¼Œåœ¨ Solidity æˆ– Vyper ä¸­ï¼Œæ¯å½“ä½ åˆ›å»ºä¸€ä¸ªå˜é‡æ—¶ï¼Œåº•å±‚å®é™…ä¸Šæ˜¯åœ¨æ ˆä¸Šæ”¾ç½®ä¸€ä¸ªå¯¹è±¡ã€‚

uint256 myNumber = 7;

è¿™å°†åœ¨æ ˆä¸Šæ”¾ç½®ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œä½¿ç”¨ PUSHX æ“ä½œç ï¼Œå…¶ä¸­æ•°å­— 7 è¢«â€œæ¨â€åˆ°æ ˆä¸Šã€‚

PUSH1 0x7 //0x7 æ˜¯åå…­è¿›åˆ¶çš„ 7

å½“ EVM çœ‹åˆ°è¿™ä¸ªæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°† 7 è½¬æ¢ä¸º 32 å­—èŠ‚ç‰ˆæœ¬ï¼Œå‰é¢æœ‰ä¸€å † 0ã€‚

å¯¹è±¡åªèƒ½åœ¨å°äº 32 å­—èŠ‚æ—¶â€œæ¨â€åˆ°æ ˆä¸Šã€‚7 åœ¨ 32 å­—èŠ‚ä¸­è¡¨ç¤ºä¸ºï¼š

`0x0000000000000000000000000000000000000000000000000000000000000007`

æ ˆå½“å‰çš„æœ€å¤§é™åˆ¶æ˜¯**1024 ä¸ªå€¼**ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„ç…é¥¼ä¾‹å­ä¸­ï¼Œâ€œ1024 ä¸ªç…é¥¼â€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¸å¤š Solidity å¼€å‘äººå‘˜ä¼šé‡åˆ°è‡­åæ˜­è‘—çš„â€œæ ˆå¤ªæ·±â€é”™è¯¯ï¼Œå› ä¸ºä»–ä»¬çš„ Solidity ä»£ç å¯¼è‡´æ ˆä¸Šæœ‰å¤ªå¤šå˜é‡ã€‚

æ ˆæ˜¯**ä¸´æ—¶çš„**ï¼Œå¹¶ä¸”åœ¨äº¤æ˜“\*å®Œæˆåï¼Œæ ˆä¸Šçš„å¯¹è±¡ä¼šè¢«é”€æ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½ åœ¨ Solidity æˆ– Vyper ä¸­åˆ›å»ºä¸€ä¸ªå˜é‡æ—¶ï¼Œå®ƒåœ¨äº¤æ˜“ç»“æŸåä¸ä¼šæŒä¹…åŒ–ï¼ˆ\*æŠ€æœ¯ä¸Šæ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡ï¼‰ã€‚è¿™æ˜¯å› ä¸ºæ ˆè¢«åˆ é™¤äº†ã€‚

function doStuff() public {  
  // å½“æœ‰äººè°ƒç”¨ \`doStuff\` æ—¶ï¼Œæ­¤å˜é‡è¢«æ·»åŠ åˆ°æ ˆä¸Š  
  // ç”±äºå®ƒåœ¨æ ˆä¸Šï¼Œå‡½æ•°è°ƒç”¨ç»“æŸåï¼Œæˆ–  
  // äº¤æ˜“ç»“æŸåï¼Œæ ˆè¢«åˆ é™¤ï¼Œå› æ­¤  
  // å˜é‡ 7 ä¹Ÿè¢«åˆ é™¤  
  uint256 myNumber = 7;  
}

æ ˆæ˜¯å­˜å‚¨å’Œæ£€ç´¢æ•°æ®çš„æœ€ä¾¿å®œçš„åœ°æ–¹ï¼ˆå°± gas è€Œè¨€ï¼‰ï¼Œå¹¶ä¸”æ˜¯ EVM ä¸­å”¯ä¸€å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œçš„åœ°æ–¹ï¼Œä¾‹å¦‚åŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€å·¦ç§»ç­‰ã€‚ç„¶è€Œï¼Œå®ƒå¹¶ä¸æ€»æ˜¯å­˜å‚¨æ•°æ®çš„æœ€ä½³ä½ç½®ã€‚

_\**æ³¨æ„ï¼šæ ˆåœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ç»“æŸæ—¶æŠ€æœ¯ä¸Šè¢«åˆ é™¤ï¼Œä½†ä½ å¯ä»¥åœ¨** [_evm.codes_](https://www.evm.codes/about)**ä¸­é˜…è¯»æ›´å¤šç›¸å…³ä¿¡æ¯ã€‚ç›®å‰ï¼Œåªéœ€å‡è®¾äº¤æ˜“ç»“æŸæ—¶æ ˆè¢«é”€æ¯ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ–‡çš„ç¬æ€å­˜å‚¨éƒ¨åˆ†è§£é‡Šè°ƒç”¨ä¸Šä¸‹æ–‡ã€‚**

# å†…å­˜

![EVM å¯ä»¥è¯»å–å’Œå†™å…¥æ•°æ®çš„ä½ç½®](https://miro.medium.com/v2/resize:fit:1400/0*Wy3xgXfFFiJhODMT)

EVMï¼šå†…å­˜

ç°åœ¨ï¼Œä¸‹ä¸€ä¸ª**ä¸´æ—¶æ•°æ®ä½ç½®**å°†æ˜¯å†…å­˜ã€‚å†…å­˜ä¸æ ˆä¸€æ ·ï¼Œåœ¨äº¤æ˜“ç»“æŸåè¢«åˆ é™¤ã€‚æœ‰æ—¶æ ˆä¸è¶³ä»¥æ”¾ç½®æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨å†…å­˜ã€‚

uint8\[3\] memory myArray = \[1,2,3\]

ä¾‹å¦‚ï¼Œæ•°ç»„æ— æ³•æ”¾å…¥æ ˆä¸­ã€‚å¯¹äºæ•°ç»„ï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨æ¯ä¸ªå…ƒç´ å’Œæ•°ç»„é•¿åº¦ã€‚å› æ­¤ï¼Œåœ¨åº•å±‚ï¼Œæˆ‘ä»¬è°ƒç”¨ MSTORE æ“ä½œç å°†æ•°æ®å­˜å‚¨åœ¨ EVM çš„å†…å­˜æ•°æ®ç»“æ„ä¸­ã€‚ä½ å¯ä»¥ç¨åé€šè¿‡è°ƒç”¨ MLOAD æ“ä½œç ä»å†…å­˜ä¸­è¯»å–ã€‚

ä½ ä¼šæ³¨æ„åˆ°ï¼Œä¸ºäº†åœ¨å†…å­˜æ•°ç»„ä¸­å­˜å‚¨ä»»ä½•å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆå°†å¯¹è±¡æ”¾åˆ°æ ˆä¸Šã€‚è¿™æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­æ¯”å­˜å‚¨åœ¨æ ˆä¸Š gas-wise æ›´æ˜‚è´µçš„åŸå› ä¹‹ä¸€ã€‚è¿˜æœ‰å…¶ä»–åŸå› ï¼ŒåŒ…æ‹¬[å†…å­˜æ‰©å±• gas æˆæœ¬](https://www.evm.codes/about#memoryexpansion) ï¼Œä½ å¯ä»¥é€šè¿‡[æ­¤é“¾æ¥](https://www.evm.codes/about#memoryexpansion)äº†è§£æ›´å¤šä¿¡æ¯ã€‚

```
PUSH1 0x1  
PUSH0 // å°† 0 æ¨å…¥å †æ ˆ  
MSTORE // è¿™ä¼šå¯¼è‡´ 0x1 è¢«å­˜å‚¨åœ¨å†…å­˜ä½ç½® 0x0

å†…å­˜å’Œå †æ ˆä¸€æ ·ï¼Œåœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ç»“æŸåä¼šè¢«åˆ é™¤ï¼ˆå¦‚æœè¿™è®©ä½ å›°æƒ‘ï¼Œå¯ä»¥å‡è®¾â€œè°ƒç”¨ä¸Šä¸‹æ–‡â€å°±æ˜¯äº¤æ˜“ã€‚è¿™æ˜¯ä¸ªå°è°è¨€ï¼Œä½†ä¸ºäº†å­¦ä¹ ï¼Œè¿™æ²¡å…³ç³»ï¼‰ã€‚

è®°ä½è¿™äº›ï¼Œå½“æˆ‘ä»¬è°ˆè®º**calldata**æ—¶ï¼Œå› ä¸ºåœ¨é‚£æ—¶æˆ‘ä»¬å°†è®¨è®ºä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å¼€å§‹æ—¶çœ‹åˆ°é‚£ä¸ªé”™è¯¯ï¼šæ•°æ®ä½ç½®å¿…é¡»æ˜¯â€œmemoryâ€æˆ–â€œcalldataâ€ã€‚

å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼Œæ¯”å¦‚ uint256 myNumber = 7ï¼Œæ€»æ˜¯é¦–å…ˆè®¾ç½®ä¸ºå †æ ˆå˜é‡ï¼Œå¹¶ä¸”æ ¹æ®ç¼–è¯‘å™¨çš„ä¸åŒï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å‡½æ•°å¤–éƒ¨çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯â€œçŠ¶æ€å˜é‡â€ï¼Œå­˜å‚¨åœ¨**storage**ä¸­ã€‚

# Storage

![EVM å¯ä»¥åœ¨å“ªé‡Œè¯»å†™æ•°æ®](https://miro.medium.com/v2/resize:fit:1400/0*QbcUo5qXOFQw_bni)

EVMï¼šå­˜å‚¨

ç°åœ¨ä¸å†…å­˜å’Œå †æ ˆä¸åŒï¼Œå­˜å‚¨æ˜¯**æ°¸ä¹…**å­˜å‚¨çš„ã€‚å½“ä½ å°†æ•°æ®å­˜å‚¨ä¸º**çŠ¶æ€å˜é‡**æ—¶ï¼Œå®ƒå°†è¢«æ°¸ä¹…å­˜å‚¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½ åœ¨ Solidity ä¸­åˆ›å»ºä¸€ä¸ªå…¬å…±å˜é‡æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨å‡½æ•°æ¥â€œè·å–â€è¯¥å€¼ã€‚ç„¶è€Œï¼Œåœ¨å‡½æ•°ä¸­åˆ›å»ºå˜é‡ä¼šå°†å…¶è®¾ç½®ä¸ºä¸´æ—¶å˜é‡ï¼ˆåœ¨å†…å­˜ä¸­æˆ–ä»…åœ¨å †æ ˆä¸Šï¼‰ã€‚

```solidity
contract MyContract{  
  uint256 myStorageVar = 7; // è¿™æ˜¯åœ¨å­˜å‚¨ä¸­  
  
  function doStuff() public {  
    uint256 myStackVar = 7; // è¿™æ˜¯åœ¨å †æ ˆä¸Š  
  }  
}
```

å°†å¯¹è±¡å­˜å‚¨åˆ°å­˜å‚¨ä¸­ä½¿ç”¨ä¸å†…å­˜ç›¸åŒçš„æ“ä½œç è®¾ç½®ï¼Œåªæ˜¯æˆ‘ä»¬ä½¿ç”¨ SSTORE å’Œ SLOAD è€Œä¸æ˜¯ MSTORE æˆ– MLOADã€‚

ä¸Šé¢çš„ä»£ç ä¸ myStorageVar å¯èƒ½ä¼šç¼–è¯‘æˆä¸€ä¸²çœ‹èµ·æ¥åƒè¿™æ ·çš„æ“ä½œç ï¼š

```
PUSH1 0x7  
PUSH0  
SSTORE // è¿™å°†æ•°å­— 7 å­˜å‚¨åœ¨å­˜å‚¨æ§½ 0
```

å°†æ•°æ®å­˜å‚¨åˆ°å­˜å‚¨ä¸­æ˜¯ EVM ä¸­å­˜å‚¨æ•°æ®çš„**æœ€æ˜‚è´µ**æ–¹å¼ï¼ˆå°± gas è€Œè¨€ï¼‰ã€‚ç”±äºæˆ‘ä»¬æ˜¯æ°¸ä¹…å­˜å‚¨æ•°æ®ï¼Œæ‰€æœ‰ EVM èŠ‚ç‚¹**å¿…é¡»**åœ¨äº¤æ˜“ç»“æŸåä»ç„¶ä¿ç•™æ•°æ®ã€‚ç”±äºæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦åšè¿™ç§â€œé¢å¤–çš„å·¥ä½œâ€æ¥æ°¸ä¹…å­˜å‚¨æ•°æ®ï¼Œå› æ­¤å®ƒä»¬å¢åŠ äº†è¿è¡Œæ‰€éœ€çš„ gas é‡ã€‚

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå­˜å‚¨æ¯”å†…å­˜ã€å †æ ˆã€ç¬æ€å­˜å‚¨å’Œ calldata ç®€å•å¾—å¤šã€‚æ‰€ä»¥è®©æˆ‘ä»¬è¿›å…¥ä¸€äº›æ›´æœ‰è¶£çš„åœ°æ–¹ã€‚

# Calldata

![EVM å¯ä»¥åœ¨å“ªé‡Œè¯»å†™æ•°æ®](https://miro.medium.com/v2/resize:fit:1400/0*7kI2tYbYKpKmb43e)

EVMï¼šCalldata

ç°åœ¨ calldata æœ‰ç‚¹éš¾ä»¥å®šä¹‰ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæœ‰ç‚¹è¿‡è½½çš„æœ¯è¯­ã€‚å½“æˆ‘ä»¬æåˆ° calldata æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼š

*   Solidity å…³é”®å­— calldata
*   EVM æ¦‚å¿µ calldata

æ ¹æ® evm.codesï¼Œcalldataï¼ˆä½œä¸º EVM æ¦‚å¿µï¼‰æ˜¯ï¼š

> calldata åŒºåŸŸæ˜¯ä½œä¸ºæ™ºèƒ½åˆçº¦äº¤æ˜“çš„ä¸€éƒ¨åˆ†å‘é€åˆ°äº¤æ˜“çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºåˆçº¦æ—¶ï¼Œcalldata å°†æ˜¯æ–°åˆçº¦çš„æ„é€ å‡½æ•°ä»£ç ã€‚calldata æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥é€šè¿‡æŒ‡ä»¤`CALLDATALOAD`ã€`CALLDATASIZE`å’Œ`CALLDATACOPY`è¯»å–ã€‚

æ¯å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬ä»¥ calldata çš„å½¢å¼å‘åˆçº¦å‘é€æ•°æ®ã€‚å› æ­¤ï¼Œå½“ EVM éœ€è¦è¯»å–æˆ‘ä»¬å‘é€ç»™åˆçº¦çš„æ•°æ®æ—¶ï¼Œå®ƒä» calldata ä¸­è¯»å–ã€‚ä¾‹å¦‚ï¼Œåœ¨ foundry / cast ä¸­ï¼Œæˆ‘å¯ä»¥é€šè¿‡å®šä¹‰æˆ‘çš„ calldata æ¥å‘é€äº¤æ˜“ã€‚æˆ–è€…å¦‚æœæˆ‘ä» Metamask å‘é€äº¤æ˜“ï¼Œæˆ‘å¯ä»¥é€šè¿‡æ£€æŸ¥åå…­è¿›åˆ¶é€‰é¡¹å¡æŸ¥çœ‹æ­£åœ¨å‘é€çš„ calldataã€‚

![](https://miro.medium.com/v2/resize:fit:1400/0*yIPJDLzPkao4zCIy)

_ä¸€ä¸ªç¤ºä¾‹ calldata ç¤ºä¾‹_

è¿™ä¸ Solidity å…³é”®å­— calldata åŸºæœ¬ç›¸åŒï¼Œä½†å½“æåˆ° Solidity calldata å…³é”®å­—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å®šä¹‰æ›´ç®€å•ã€‚åœ¨ Solidity ä¸­ï¼Œåªæœ‰å‡½æ•°å‚æ•°å¯ä»¥è¢«è§†ä¸º calldataï¼Œå› ä¸ºåªæœ‰å‡½æ•°å¯ä»¥ç”¨ calldata è°ƒç”¨ã€‚

ä¸€æ—¦åœ¨äº¤æ˜“ä¸­å‘é€ï¼Œcalldata å°±ä¸èƒ½æ›´æ”¹ã€‚å®ƒå¿…é¡»å­˜å‚¨åœ¨å¦ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­ï¼ˆå¦‚å †æ ˆã€å†…å­˜ã€å­˜å‚¨ç­‰ï¼‰ä»¥è¿›è¡Œæ“ä½œã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº† calldata å’Œå†…å­˜ï¼Œè®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬åœ¨å¼€å§‹è¿™ç¯‡æ–‡ç« æ—¶é‡åˆ°çš„é”™è¯¯ã€‚

```solidity
function doStuff(string stuff) public {  
// ä¸Šé¢çš„ä»£ç å°†æ— æ³•ç¼–è¯‘ï¼ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š  
// TypeError: æ•°æ®ä½ç½®å¿…é¡»æ˜¯"memory"æˆ–"calldata"å¯¹äºå‡½æ•°ä¸­çš„å‚æ•°ï¼Œä½†æ²¡æœ‰ç»™å‡º
```

åœ¨æˆ‘ä»¬çš„å‡½æ•° doStuff ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ solidity ç¼–è¯‘å™¨æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†å­—ç¬¦ä¸² stuff å¯¹è±¡ã€‚å­—ç¬¦ä¸² stuff å¯¹è±¡æ˜¯ solidity ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯[å­—èŠ‚æ•°ç»„å¯¹è±¡ã€‚](https://docs.soliditylang.org/en/v0.8.26/types.html#bytes-and-string-as-arrays) ç”±äºå®ƒä»¬æ˜¯æ•°ç»„ï¼Œå®ƒä»¬å¯èƒ½å¤§äº 32 å­—èŠ‚ï¼Œå› æ­¤å®ƒä»¬ä¸èƒ½æ”¾åœ¨å †æ ˆä¸Šã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å‘Šè¯‰ solidity ç¼–è¯‘å™¨ä¼ å…¥çš„æ•°æ®å°†å­˜å‚¨åœ¨å†…å­˜ä¸­è¿˜æ˜¯ calldata ä¸­ã€‚

å¦‚æœæ˜¯å†…å­˜ï¼š

*   æˆ‘ä»¬å¯ä»¥æ“ä½œ stuff å¯¹è±¡ï¼ˆæ·»åŠ åˆ°å­—ç¬¦ä¸²ï¼Œä¿å­˜æ–°å­—ç¬¦ä¸²ç­‰ï¼‰
*   æˆ‘ä»¬å¯ä»¥ç”¨å­˜å‚¨åœ¨å†…å­˜æˆ– calldata ä¸­çš„æ•°æ®è°ƒç”¨ doStuff å‡½æ•°

å¦‚æœæ˜¯ calldataï¼š

*   æˆ‘ä»¬ä¸èƒ½æ“ä½œ stuff å¯¹è±¡
*   æˆ‘ä»¬åªèƒ½ç”¨å­˜å‚¨ä¸º calldata çš„æ•°æ®è°ƒç”¨ doStuff å‡½æ•°

æ¯å½“æˆ‘ä»¬ä»åŒºå—é“¾å¤–éƒ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨ ERC20 åˆçº¦ä¸Šçš„ transfer å¹¶ç”¨ä½ çš„ Metamask æˆ–å…¶ä»–æµè§ˆå™¨é’±åŒ…ç­¾åï¼‰ï¼Œè¯¥æ•°æ®æ€»æ˜¯ä½œä¸º calldata å‘é€çš„ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªåˆçº¦è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œå®ƒå¯ä»¥å°†æ•°æ®ä½œä¸º calldata æˆ–å†…å­˜å‘é€ã€‚

Solidity è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥é€šè¿‡å°† calldata å­˜å‚¨åˆ°å†…å­˜ä¸­æ¥è½¬æ¢ calldata -> å†…å­˜ï¼Œä½†å®ƒä¸èƒ½å°†å†…å­˜ä¸­çš„æ•°æ®ç§»åŠ¨åˆ° calldata ä¸­ã€‚calldata æ˜¯åŸå§‹äº¤æ˜“çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸èƒ½ç¼–è¾‘åŸå§‹äº¤æ˜“æ•°æ®ã€‚

```solidity
// è®©æˆ‘ä»¬æœ€åˆä» Metamask / æµè§ˆå™¨é’±åŒ…è°ƒç”¨è¿™ä¸ªå‡½æ•°  
function calledFromMetamask(uint256[] calldata myArray) public {  
  // calldata -> calldata  
  calledFromFunctionCalldata(myArray);  
  // calldata -> memory  
  calledFromFunctionMemory(myArray);  
}  
  
function calledFromFunctionCalldata(uint256[] calldata myArray) public {  
  // calldata -> calldata -> memory  
  calledFromFunctionMemory(myArray);  
}  
  
function calledFromFunctionMemory(uint256[] memory myArray) public {  
  // å–æ¶ˆæ³¨é‡Šä¸‹é¢çš„è¡Œå°†æ— æ³•ç¼–è¯‘ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»  
  // å°† myArray ä» calldata è½¬æ¢ä¸ºå†…å­˜  
  // calledFromFunctionCalldata(myArray);  
}
```

è¿™ç§åŒºåˆ«å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°è®¸å¤š gas çš„æƒè¡¡ï¼Œå¹¶å‘Šè¯‰ç¼–è¯‘å™¨åœ¨å“ªé‡ŒæŸ¥æ‰¾æ•°æ®ã€‚

calldata åœ¨äº¤æ˜“æˆ–è°ƒç”¨ä¸Šä¸‹æ–‡ç»“æŸåè¢«åˆ é™¤ï¼Œå¯ä»¥è¢«è§†ä¸ºåƒå †æ ˆå’Œå†…å­˜ä¸€æ ·çš„ä¸´æ—¶æ•°æ®ä½ç½®ã€‚

# Transient Storage

![](https://miro.medium.com/v2/resize:fit:1400/0*MvT1xpTflk4ef91b)

EVMï¼šç¬æ€å­˜å‚¨ï¼ˆTSTOREï¼ŒTLOADï¼‰

æ ¹æ® [EIP-1153](https://eips.ethereum.org/EIPS/eip-1153)ï¼Œç°åœ¨æœ‰ä¸€ä¸ªé¢å¤–çš„ä½ç½®ï¼Œåƒå­˜å‚¨ä¸€æ ·ï¼Œä½†åœ¨äº¤æ˜“ç»“æŸåè¢«åˆ é™¤ï¼Œä½¿å…¶æˆä¸ºå¦ä¸€ä¸ªä¸´æ—¶å­˜å‚¨ä½ç½®ã€‚ç„¶è€Œï¼Œä¸å †æ ˆã€å†…å­˜å’Œ calldata ä¸åŒï¼Œå®ƒä»¬åœ¨**è°ƒç”¨ä¸Šä¸‹æ–‡**ç»“æŸåè¢«åˆ é™¤ï¼Œç¬æ€å­˜å‚¨åœ¨äº¤æ˜“ç»“æŸåè¢«åˆ é™¤ã€‚è®©æˆ‘ä»¬äº†è§£â€œè°ƒç”¨ä¸Šä¸‹æ–‡â€æˆ–â€œè°ƒç”¨ä¸Šä¸‹æ–‡â€æ˜¯ä»€ä¹ˆï¼Œä»¥ç†è§£è¿™ä¸€ç‚¹ã€‚

# ä»€ä¹ˆæ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Ÿ

![](https://miro.medium.com/v2/resize:fit:1400/0*Ys8OUpGdksj2r67a)

EVMï¼šè°ƒç”¨ä¸Šä¸‹æ–‡

æ¯å½“åœ¨äº¤æ˜“ä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆå¤–éƒ¨å‡½æ•°è°ƒç”¨æˆ–å†…éƒ¨è°ƒç”¨ï¼‰æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„â€œè°ƒç”¨ä¸Šä¸‹æ–‡â€ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»é«˜äº®æ˜¾ç¤ºäº†è¢«è§†ä¸ºâ€œè°ƒç”¨ä¸Šä¸‹æ–‡â€çš„åŒºåŸŸï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š
```


*   ç¨‹åºè®¡æ•°å™¨
*   å¯ç”¨ gas
*   å †æ ˆ
*   å†…å­˜

æœ¬è´¨ä¸Šï¼Œè¿™äº›æ˜¯ä¸ºå‡½æ•°å­˜å‚¨å’Œæ“ä½œæ•°æ®è€Œéš”ç¦»çš„ç¯å¢ƒã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸¤ä¸ªå‡½æ•°ä¸èƒ½è®¿é—®å½¼æ­¤çš„å˜é‡ã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥æœ‰å®Œå…¨ç›¸åŒçš„å˜é‡åï¼Œä½†å®ƒä»¬æ°¸è¿œä¸ä¼šé‡å ã€‚æ¯å½“ä½ è°ƒç”¨ doStuff æˆ– doMoreStuff æ—¶ï¼Œå®ƒä»¬å°†å„è‡ªè·å¾—è‡ªå·±çš„è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œæ‹¥æœ‰è‡ªå·±çš„å †æ ˆã€å†…å­˜ã€calldata ç­‰ã€‚

```solidity
function doStuff() public {  
  uint256 myNumber = 7;  
}  
  
function doMoreStuff() public {  
  uint256 myNumber = 8;  
}
```

å½“é‡åˆ° RETURNã€STOPã€INVALID æˆ– REVERT æ“ä½œç æ—¶ï¼Œæˆ–å½“äº¤æ˜“å›æ»šæ—¶ï¼Œè°ƒç”¨ä¸Šä¸‹æ–‡ç»“æŸã€‚

ç†è§£è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å›åˆ°ç†è§£ç¬æ€å­˜å‚¨ã€‚è‡ª Solidity ç‰ˆæœ¬ 0.8.24 èµ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ yul ä¸­ä½¿ç”¨ TSTORE å’Œ TLOAD æ“ä½œç ã€‚

```solidity
modifier nonreentrant(bytes32 key) {  
  assembly {  
    if tload(key) { revert(0, 0) }  
    tstore(key, 1)  
  }  
  
  \_;  
  
  assembly {  
    tstore(key, 0)  
  }  
}
```

`TSTORE`å’Œ`TLOAD`æ“ä½œç çš„å·¥ä½œæ–¹å¼ä¸`SSTORE`å’Œ`SLOAD`å­˜å‚¨æ“ä½œç å®Œå…¨ç›¸åŒï¼Œä½†ä¸æ˜¯æ°¸ä¹…å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯åœ¨æ•´ä¸ªäº¤æ˜“æœŸé—´å­˜å‚¨æ•°æ®ï¼Œå¹¶åœ¨äº¤æ˜“ç»“æŸååˆ é™¤ã€‚

åœ¨æœ¬æ–‡çš„åº•éƒ¨ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªé€ŸæŸ¥è¡¨æ¥å¸®åŠ©è¯´æ˜å·®å¼‚ã€‚

# ä»£ç 

![](https://miro.medium.com/v2/resize:fit:1400/0*pKBChC5Z1DEo_NTg)

EVMï¼šä»£ç 

æˆ‘ä»¬å¯ä»¥å­˜å‚¨æ•°æ®çš„æœ€åä¸€ä¸ªåœ°æ–¹ä¹‹ä¸€æ˜¯ä½œä¸ºåˆçº¦ï¼Œå³åœ¨ EVM çš„â€œä»£ç â€ä½ç½®ã€‚è¿™éå¸¸ç®€å•ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ solidity ä¸­ä½¿ç”¨æ ‡è®°ä¸º constant å’Œ immutable çš„å˜é‡æ— æ³•æ›´æ”¹çš„åŸå› ã€‚

```solidity
uint256 constant MY_VAR = 7;  
uint256 immutable i_myVar = 7;
```

ä¸å¯å˜å’Œå¸¸é‡å˜é‡ç›´æ¥å­˜å‚¨åœ¨åˆçº¦ä»£ç ä¸­ï¼Œæ°¸è¿œæ— æ³•æ›´æ”¹ã€‚\* æ ¹æ® [solidity æ–‡æ¡£](https://docs.soliditylang.org/en/v0.8.26/contracts.html#immutable) ï¼š

> ç¼–è¯‘å™¨ç”Ÿæˆçš„åˆçº¦åˆ›å»ºä»£ç å°†åœ¨è¿”å›ä¹‹å‰é€šè¿‡ç”¨åˆ†é…ç»™å®ƒä»¬çš„å€¼æ›¿æ¢æ‰€æœ‰å¯¹ä¸å¯å˜å˜é‡çš„å¼•ç”¨æ¥ä¿®æ”¹åˆçº¦çš„è¿è¡Œæ—¶ä»£ç ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›å€¼æ— æ³•æ›´æ”¹ï¼Œå®ƒä»¬å­˜å‚¨åœ¨åˆçº¦å­—èŠ‚ç æœ¬èº«ä¸­ã€‚

_\*åˆçº¦åªèƒ½é€šè¿‡ SELFDESTRUCT æ“ä½œç åˆ é™¤ï¼Œç„¶åè¯¥åˆçº¦å¯ä»¥åœ¨ä»¥åæ›¿æ¢ã€‚ç„¶è€Œï¼Œè¯¥æ“ä½œç å­˜åœ¨äº‰è®®ï¼Œå¹¶è®¡åˆ’åœ¨æŸä¸ªæ—¶å€™ç§»é™¤ã€‚è‡ª EVM cancun å‡çº§ä»¥æ¥ï¼Œè¿™ä»…åœ¨åŒä¸€äº¤æ˜“ä¸­å¯èƒ½ï¼Œæ ¹æ®_ [_EIP-6780_](https://eips.ethereum.org/EIPS/eip-6780)_ã€‚_

# EVM æ•°æ®ç»“æ„é€ŸæŸ¥è¡¨

![](https://miro.medium.com/v2/resize:fit:1400/1*LtqGYVKfgJfgsGT320H71Q.png)

EVM æ•°æ®ç»“æ„é€ŸæŸ¥è¡¨

# è¿”å›æ•°æ®

EVM å¯ä»¥è¯»å–å’Œå†™å…¥çš„æœ€åä¸€ä¸ªåœ°æ–¹ä¹‹ä¸€æ˜¯è¿”å›æ•°æ®ä½ç½®ã€‚æ ¹æ® evm.codesï¼š

> è¿”å›æ•°æ®æ˜¯æ™ºèƒ½åˆçº¦åœ¨è°ƒç”¨åè¿”å›å€¼çš„æ–¹å¼ã€‚å®ƒå¯ä»¥é€šè¿‡ RETURN å’Œ REVERT æŒ‡ä»¤ç”±åˆçº¦è°ƒç”¨è®¾ç½®ï¼Œå¹¶å¯ä»¥é€šè¿‡è°ƒç”¨åˆçº¦ä½¿ç”¨ RETURNDATASIZE å’Œ RETURNDATACOPY è¯»å–ã€‚

æœ¬è´¨ä¸Šï¼Œæ¯å½“ä½ çœ‹åˆ° return å…³é”®å­—æ—¶ï¼Œè¿™å°†åˆ›å»º`RETURN`æ“ä½œç ä»¥å°†æ•°æ®å­˜å‚¨åˆ°è¿”å›æ•°æ®ä½ç½®ã€‚

```solidity
function doStuff() public returns(uint256) {  
  return uint256(7);  
}
```

è¿™å¯ä»¥é€šè¿‡è°ƒç”¨æ­¤æ•°æ®çš„å…¶ä»–å‡½æ•°è¯»å–ï¼Œä½¿ç”¨`CALL`ã€`STATICCALL`ã€`CREATE`ã€`DELEGATECALL`å’Œå…¶ä»–ä¸€äº›æ“ä½œç ã€‚è¿”å›æ•°æ®æœ‰ç‚¹å¥‡æ€ªï¼Œè°ƒç”¨`RETURN`æ“ä½œç å°†ç»“æŸå½“å‰è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œç„¶åå°†ç»“æœæ•°æ®ä½œä¸ºè¿”å›æ•°æ®ä¼ é€’ç»™çˆ¶è°ƒç”¨ä¸Šä¸‹æ–‡ã€‚ç„¶åå¯ä»¥ä½¿ç”¨`RETURNDATASIZE`å’Œ`RETURNDATACOPY`è®¿é—®æ•°æ®ã€‚åªæœ‰ä¸€ä¸ªè¿”å›æ•°æ®ï¼Œè°ƒç”¨è¿™äº›æ“ä½œç å°†è¿”å›æœ€è¿‘ç»“æŸçš„è°ƒç”¨ä¸Šä¸‹æ–‡çš„è¿”å›æ•°æ®ã€‚è¿”å›æ•°æ®ä¸ä¼šæŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡å­ä¸Šä¸‹æ–‡è°ƒç”¨`RETURN`æ“ä½œç è½»æ¾è¦†ç›–ã€‚

è¿™æ„å‘³ç€æ˜¯çš„ï¼Œåœ¨ä¸€ä¸ªè°ƒç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œåªèƒ½æœ‰ä¸€å—æ•°æ®ã€‚ç„¶è€Œï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥å¤§äº 32 å­—èŠ‚ï¼Œå› æ­¤ä½ å¯ä»¥å°†æ•´ä¸ªæ•°ç»„å’Œå…¶ä»–å¤§å˜é‡æ”¾å…¥è¿”å›æ•°æ®ä¸­ã€‚

# å†™å…¥ï¼Œä½†ä¸è¯»å–

# æ—¥å¿—

æ—¥å¿—æ˜¯ EVM ä¸­ä»£ç çº¯ç²¹å†™å…¥çš„å­˜å‚¨ä½ç½®ã€‚åœ¨ Solidity ä¸­ï¼Œè¿™æ˜¯é€šè¿‡ emit å…³é”®å­—å®Œæˆçš„ã€‚

```solidity
event myEvent();  
emit myEvent();
```

# è¯»å–ï¼Œä½†ä¸å†™å…¥

åœ¨ EVM ä¸­ï¼Œæœ‰è®¸å¤šåœ°æ–¹å¯ä»¥è¯»å–æ•°æ®ã€‚ä½ å¯ä»¥åœ¨ solidity ä¸­çœ‹åˆ°è¿™äº›ä¾‹å­ï¼š

```solidity
msg.sender;  
block.chainid;  
blobhash(0);  
gasleft();
```

ä»¥åŠè®¸å¤šå…¶ä»–[å…¨å±€å¯ç”¨å•å…ƒ](https://docs.soliditylang.org/en/latest/units-and-global-variables.html) ã€‚

# æ€»ç»“

å¸Œæœ›é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œä½ èƒ½æ›´å¥½åœ°ç†è§£ EVM çš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œä»è€Œåšå‡ºæ›´æ˜æ™ºçš„å†³ç­–ï¼

æœ€é‡è¦çš„æ˜¯ï¼Œä½ ç°åœ¨çŸ¥é“ä¸ºä»€ä¹ˆåœ¨ solidity ä¸­ä¼šçœ‹åˆ°é‚£äº›å¸¸è§çš„â€œå †æ ˆè¿‡æ·±â€å’Œâ€œå¿…é¡»ä½¿ç”¨ calldata æˆ– memoryâ€çš„ç¼–è¯‘å™¨é”™è¯¯ï¼

**è¦å­¦ä¹ æ™ºèƒ½åˆçº¦å®‰å…¨æ€§å’Œå¼€å‘ï¼Œè¯·è®¿é—®** [_Cyfrin Updraft_](https://updraft.cyfrin.io/)ã€‚

**è¦ä¸ºä½ çš„æ™ºèƒ½åˆçº¦é¡¹ç›®è¯·æ±‚å®‰å…¨æ”¯æŒ/å®‰å…¨å®¡æŸ¥ï¼Œè¯·è®¿é—®** [_Cyfrin.io_](http://cyfrin.io/) **æˆ–** [_CodeHawks.com_](https://codehawks.com/)_ã€‚_

**è¦äº†è§£æ›´å¤šå…³äºæ™ºèƒ½åˆçº¦ä¸­æŠ¥å‘Šçš„é¡¶çº§æ”»å‡»ï¼Œè¯·åŠ¡å¿…å­¦ä¹ ** [_Solodit_](https://solodit.xyz/)_ã€‚_

> æˆ‘æ˜¯ [AI ç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œåœ¨[è¿™é‡Œ](https://github.com/lbc-team/Pioneer/blob/master/translations/9475.md)ä¿®æ”¹ï¼Œè¿˜è¯·åŒ…æ¶µï½