
>- åŸæ–‡é“¾æ¥ï¼š[www.quicknode.com/guides...](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol)
>- è¯‘è€…ï¼š[AIç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œæ ¡å¯¹ï¼š[ç¿»è¯‘å°ç»„](https://learnblockchain.cn/people/412)
>- æœ¬æ–‡é“¾æ¥ï¼š[learnblockchain.cn/articleâ€¦](https://learnblockchain.cn/article/10622)
    
# å¦‚ä½•ä½¿ç”¨ Solana Web3.js 2.0 å‘é€äº¤æ˜“

*10 åˆ†é’Ÿé˜…è¯»*

## æ¦‚è¿°  

Solana [æœ€è¿‘å®£å¸ƒ](https://blog.quicknode.com/solana-web3-js-2-0-a-new-chapter-in-solana-development/) äº† Solana Web3.js 2.0 çš„å‘å¸ƒå€™é€‰ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä»–ä»¬ä¸ Solana åŒºå—é“¾äº¤äº’çš„ JavaScript åº“çš„é‡è¦æ›´æ–°ã€‚æœ¬æŒ‡å—å°†æ•™ä½ ä½¿ç”¨è¿™ä¸ªæ–°åº“å‘é€äº¤æ˜“çš„åŸºç¡€çŸ¥è¯†ã€‚

è®©æˆ‘ä»¬å¼€å§‹å§ï¼

### ä½ å°†è¦åšçš„äº‹æƒ… 

ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œä»¥ä½¿ç”¨ Solana Web3.js 2.0 åº“æ‰§è¡ŒåŸºæœ¬çš„ Solana äº¤æ˜“ï¼š

- ä½¿ç”¨æœ¬åœ° RPC æ–¹æ³•å’Œå·¥å‚å‡½æ•°è¿›è¡Œ SOL ç©ºæŠ•
- ä½¿ç”¨æ–° API åˆ›å»ºå¹¶å‘é€è½¬è´¦äº¤æ˜“

### ä½ å°†éœ€è¦çš„å†…å®¹  

- å¯¹ Solana åŸºç¡€çŸ¥è¯†çš„äº†è§£ï¼ˆ [æŒ‡å—ï¼šSolana å…¥é—¨](https://www.quicknode.com/guides/solana-development/getting-started/solana-fundamentals-reference-guide?utm_source=internal&utm_campaign=guides&utm_content=web3-2) ï¼‰
- å®‰è£… [Node.js](https://nodejs.org/en/)ï¼ˆç‰ˆæœ¬ 19 æˆ–æ›´é«˜ï¼‰
- å®‰è£… [TypeScript](https://www.typescriptlang.org/download/) å’Œ [ts-node](https://www.npmjs.com/package/ts-node)
- å®‰è£… [Solana CLI](https://docs.solanalabs.com/cli/install)

#### æœ¬æŒ‡å—ä¸­ä½¿ç”¨çš„ä¾èµ–é¡¹  

| ä¾èµ–é¡¹ | ç‰ˆæœ¬ |
| --- | --- |
| @solana/web3.js | >=2.0 |
| @solana-program/system | ^0.5.0 |
| solana cli | 1.18.8 |

è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## ä»€ä¹ˆæ˜¯ Solana Web3.js 2.0?  

Solana Web3.js 2.0 æ˜¯ä¸ Solana åŒºå—é“¾äº¤äº’çš„ JavaScript åº“çš„é‡è¦æ›´æ–°ã€‚å®ƒå¼•å…¥äº†ä¸€ç§æ–°çš„ API è®¾è®¡ï¼Œä¸“æ³¨äºå¯ç»„åˆæ€§ã€æ¨¡å—åŒ–å’Œæ”¹è¿›çš„å¼€å‘è€…ä½“éªŒã€‚ä¸€äº›å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š

1. å‡½æ•°å¼ APIï¼šæ–°çš„ API ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹é£æ ¼ï¼Œä½¿ç»„åˆå¤æ‚æ“ä½œå˜å¾—æ›´åŠ å®¹æ˜“ã€‚
2. æ”¹è¿›çš„ TypeScript æ”¯æŒï¼šæ›´å¥½çš„ç±»å‹æ¨æ–­å’Œæ›´ä¸¥æ ¼çš„ç±»å‹ä»¥å¢å¼ºä»£ç å®‰å…¨æ€§ã€‚
3. æ¨¡å—åŒ–è®¾è®¡ï¼šåŠŸèƒ½è¢«åˆ†æˆæ›´å°ã€æ›´ä¸“æ³¨çš„æ¨¡å—ï¼Œå…è®¸æ ‘æ‘‡å’Œæ›´å°çš„æ†ç»‘å¤§å°ã€‚
4. åŠ å¼ºçš„é”™è¯¯å¤„ç†ï¼šæ›´å…·ä¿¡æ¯æ€§çš„é”™è¯¯æ¶ˆæ¯å’Œæ”¹è¿›çš„é”™è¯¯ç±»å‹ã€‚

æœ‰å…³ API æ›´æ”¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬çš„ï¼ˆ [åšå®¢ï¼šSolana Web3.js 2.0 ä¸­çš„æ–°ç‰¹æ€§](https://blog.quicknode.com/) ï¼‰ã€‚

è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥æ‰§è¡ŒåŸºæœ¬è½¬è´¦äº¤æ˜“æ¥æ¢ç´¢è¿™äº›åŠŸèƒ½ã€‚

## åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®  

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¾ç½®é¡¹ç›®ï¼š

```codeBlockLines_e6Vv
mkdir solana-transfer-demo && cd solana-transfer-demo

```

æ¥ä¸‹æ¥ï¼Œå°†ä½ çš„é¡¹ç›®åˆå§‹åŒ–ä¸º Node.js é¡¹ç›®ï¼š

```codeBlockLines_e6Vv
npm init -y

```

å®‰è£…ä¾èµ–é¡¹ï¼š

```codeBlockLines_e6Vv
npm install @solana/web3.js@2 @solana-program/system && npm install --save-dev @types/node

```

> æ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ä½äº 18ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ `--legacy-peer-deps` æ ‡å¿—å®‰è£… `@solana-program/system` åŒ…ã€‚

å‘é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ª `tsconfig.json` æ–‡ä»¶ï¼Œå¹¶å¯ç”¨ `resolveJsonModule`ï¼š

```codeBlockLines_e6Vv
tsc --init --resolveJsonModule true

```

åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º `transfer.ts` çš„æ–°æ–‡ä»¶ã€‚

```codeBlockLines_e6Vv
echo > transfer.ts

```

å¤ªå¥½äº†ã€‚è®©æˆ‘ä»¬å†™ä¸€äº›ä»£ç ï¼

## å¯¼å…¥ä¾èµ–  

åœ¨ä½ çš„ `transfer.ts` æ–‡ä»¶ä¸­ï¼Œé¦–å…ˆå¯¼å…¥æ‰€éœ€çš„ä¾èµ–ï¼š

```codeBlockLines_e6Vv
import {
    airdropFactory,
    createKeyPairSignerFromBytes,
    createSolanaRpc,
    createSolanaRpcSubscriptions,
    generateKeyPairSigner,
    lamports,
    sendAndConfirmTransactionFactory,
    pipe,
    createTransactionMessage,
    setTransactionMessageFeePayer,
    setTransactionMessageLifetimeUsingBlockhash,
    appendTransactionMessageInstruction,
    signTransactionMessageWithSigners,
    getSignatureFromTransaction,
    address,
} from "@solana/web3.js";
import { getTransferSolInstruction } from "@solana-program/system";

const LAMPORTS_PER_SOL = BigInt(1_000_000_000);

```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ­£åœ¨ä»æ–°çš„ Solana Web3.js 2.0 åº“ä¸­å¯¼å…¥å„ç§å‡½æ•°ã€‚è¯·æ³¨æ„å¯¼å…¥çš„å‡½æ•°å¼é£æ ¼ - æ¯ä¸ªå‡½æ•°è´Ÿè´£ç‰¹å®šçš„ä»»åŠ¡ï¼Œä¿ƒä½¿æ¨¡å—åŒ–å’Œå¯ç»„åˆæ€§ã€‚`LAMPORTS_PER_SOL` å¸¸é‡ä¸å†é€šè¿‡ SDK æä¾›ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è‡ªå·±å®šä¹‰å®ƒã€‚ä¸ä»¥å‰çš„ SDK ä¸åŒï¼Œæ–°çš„ SDK å¯¹æ‰€æœ‰é‡‘é¢ä½¿ç”¨ bigintï¼ˆä»¥æ›´å¥½åœ°ä¸ Rust ç¼–ç¨‹å…¼å®¹ï¼ŒRust æ”¯æŒ _u64_ï¼Œè¿™æ˜¯ Solana ç¨‹åºä¸­çš„å¸¸è§ç±»å‹ï¼‰ã€‚

## åˆ›å»ºä¸»å‡½æ•°  

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ `main` å‡½æ•°ï¼Œå®ƒå°†å®¹çº³è„šæœ¬çš„é€»è¾‘ï¼š

```codeBlockLines_e6Vv
async function main() {
    // 1 - å»ºç«‹ä¸ Solana é›†ç¾¤çš„è¿æ¥

    // 2 - ç”Ÿæˆç­¾åè€…

    // 3 - ä¸ºè´¦æˆ·ç©ºæŠ• SOL

    // 4 - åˆ›å»ºè½¬è´¦äº¤æ˜“

    // 5 - ç­¾åå¹¶å‘é€äº¤æ˜“
}

main();

```

## å»ºç«‹ä¸ Solana é›†ç¾¤çš„è¿æ¥  

åœ¨ `main` å‡½æ•°å†…ï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¸æœ¬åœ° Solana é›†ç¾¤çš„è¿æ¥ï¼š

```codeBlockLines_e6Vv
    // 1 - å»ºç«‹ä¸ Solana é›†ç¾¤çš„è¿æ¥
    const httpProvider = 'http://127.0.0.1:8899';
    const wssProvider = 'ws://127.0.0.1:8900';
    const rpc = createSolanaRpc(httpProvider);
    const rpcSubscriptions = createSolanaRpcSubscriptions(wssProvider);
    console.log(`âœ… - å·²å»ºç«‹ä¸ ${httpProvider} çš„è¿æ¥`);

```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ `createSolanaRpc` å’Œ `createSolanaRpcSubscriptions` å‡½æ•°æ¥åˆ›å»ºæˆ‘ä»¬çš„ RPC è¿æ¥ã€‚å¦‚æœä½ ç†Ÿæ‚‰æ—§ SDKï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æ–°çš„ SDK ä½¿ç”¨ä¸åŒçš„æ–¹æ³•æ¥å»ºç«‹è¿æ¥ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æŒ‡å—ä¸­ä½¿ç”¨æœ¬åœ°ä¸»æœºï¼Œä½†å¦‚æœä½ å‡†å¤‡å¥½è¿æ¥åˆ°è¿œç¨‹ Solana é›†ç¾¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ä½ çš„ QuickNode HTTP Provider å’Œ WSS Provider ç«¯ç‚¹ï¼Œä»ä½ çš„ [QuickNode Dashboard](https://dashboard.quicknode.com/endpoints?utm_source=internal&utm_campaign=guides&utm_content=web3-2)ã€‚

![QuickNode ç«¯ç‚¹](https://img.learnblockchain.cn/attachments/migrate/1737077886613)

å¦‚æœä½ è¿˜æ²¡æœ‰ QuickNode è´¦æˆ·ï¼Œä½ å¯ä»¥ [åœ¨è¿™é‡Œ](https://www.quicknode.com/signup?utm_source=internal&utm_campaign=guides&utm_content=transfer-sol) å…è´¹åˆ›å»ºä¸€ä¸ªã€‚

## ç”Ÿæˆç­¾åè€…  

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„äº¤æ˜“ç”Ÿæˆä¸¤ä¸ªç­¾åè€…ï¼š

```codeBlockLines_e6Vv
    // 2 - ç”Ÿæˆç­¾åè€…
    const user1 = await generateKeyPairSigner();
    console.log(`âœ… - æ–°çš„ user1 åœ°å€å·²åˆ›å»ºï¼š${user1.address}`);
    const user2 = await createKeyPairSignerFromBytes(new Uint8Array([/* åœ¨è¿™é‡Œå¡«å†™ä½ çš„ç§é’¥å­—èŠ‚ */]));
    console.log(`âœ… - ä»æ–‡ä»¶ç”Ÿæˆ user2 åœ°å€ï¼š${user2.address}`);

```

å‡ºäºå­¦ä¹ ç›®çš„ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨ä¸¤ç§æ–¹å¼ç”Ÿæˆå¯†é’¥å¯¹ã€‚é¦–å…ˆï¼Œä½¿ç”¨ `generateKeyPairSigner` ä¸º user1 åˆ›å»ºæ–°çš„å¯†é’¥å¯¹ï¼Œç„¶åä½¿ç”¨ `createKeyPairSignerFromBytes` ä»ç°æœ‰åç§˜é’¥åˆ›å»º user2 çš„å¯†é’¥å¯¹ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ç§é’¥ï¼Œå¯ä»¥ä½¿ç”¨ Solana CLI ç”Ÿæˆä¸€ä¸ªï¼š

```codeBlockLines_e6Vv
solana-keygen new --no-bip39-passphrase --outfile ./my-keypair.json

```

å¦‚æœä½ æ›´å–œæ¬¢ä»æ–‡ä»¶åŠ è½½ç§˜å¯†ï¼Œå¯ä»¥ä½¿ç”¨ `import` è¯­å¥ï¼ˆå› ä¸ºæˆ‘ä»¬åœ¨ `tsconfig.json` æ–‡ä»¶ä¸­ä½¿ç”¨äº† `--resolveJsonModule` æ ‡å¿—ï¼‰ï¼š

```codeBlockLines_e6Vv
// æ·»åŠ åˆ°ä½ çš„å¯¼å…¥ä¸­
import secret from './my-keypair.json';

    // ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢ `user2` è¡Œï¼š
    const user2 = await createKeyPairSignerFromBytes(new Uint8Array(secret));

```

## ä¸ºè´¦æˆ·ç©ºæŠ• SOL  
åœ¨æˆ‘ä»¬å¯ä»¥è½¬è´¦ SOL ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„è´¦æˆ·æä¾›èµ„é‡‘ã€‚åŒæ ·ï¼Œä¸ºäº†æ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹æ³•ï¼ˆä¸€ç§ä½¿ç”¨æœ¬åœ°çš„ `requestAirdrop` æ–¹æ³•ï¼Œå¦ä¸€ç§ä½¿ç”¨ `airdropFactory` å‡½æ•°ï¼‰ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° `main` å‡½æ•°ï¼š
```

```codeBlockLines_e6Vv
    // 3 - å‘è´¦æˆ·ç©ºæŠ• SOL
    // ä½¿ç”¨ RPC æ–¹æ³•
    const tx1 = await rpc.requestAirdrop(
        user1.address,
        lamports(LAMPORTS_PER_SOL),
        { commitment: 'processed' }
    ).send();
    console.log(`âœ… - user1 ä½¿ç”¨ RPC æ–¹æ³•ç©ºæŠ• 1 SOL`);
    console.log(`âœ… - tx1: ${tx1}`);

    // ä½¿ç”¨å·¥å‚å‡½æ•°
    const airdrop = airdropFactory({ rpc, rpcSubscriptions });
    const tx2 = await airdrop({
        commitment: 'processed',
        lamports: lamports(LAMPORTS_PER_SOL),
        recipientAddress: user2.address
    });
    console.log(`âœ… - user2 ä½¿ç”¨å·¥å‚å‡½æ•°ç©ºæŠ• 1 SOL`);
    console.log(`âœ… - tx2: ${tx2}`);

```

è¿™ä¸¤ç§æ–¹æ³•åŒæ ·å¯è¡Œï¼Œå› æ­¤ä½ å¯ä»¥é€‰æ‹©æœ€é€‚åˆä½ ç”¨ä¾‹çš„æ–¹æ³•ã€‚æ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œä½ éƒ½éœ€è¦ä¼ é€’ç›®æ ‡åœ°å€ã€è¦ç©ºæŠ•çš„ SOL æ•°é‡ï¼ˆè¯·æ³¨æ„ï¼Œæ–° SDK è¦æ±‚æˆ‘ä»¬ä½¿ç”¨ `lamports` å‡½æ•°ï¼Œè¿™å®é™…ä¸Šæ‰©å±•äº† `bigint` ç±»å‹ï¼‰å’Œæ‰¿è¯ºçº§åˆ«ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ `lamports` å‡½æ•°å°† SOL è½¬æ¢ä¸º lamportsï¼Œåè€…æ˜¯ Solana ä½¿ç”¨çš„è®¡é‡å•ä½ã€‚

## åˆ›å»ºå¹¶å‘é€è½¬è´¦äº¤æ˜“ 

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå¹¶å‘é€æˆ‘ä»¬çš„è½¬è´¦äº¤æ˜“ã€‚æ­¤è¿‡ç¨‹å±•ç¤ºäº†æ–° Solana Web3.js 2.0 SDK çš„å‡ ä¸ªåŸºæœ¬ç‰¹æ€§ï¼š

```codeBlockLines_e6Vv
    // 4 - åˆ›å»ºè½¬è´¦äº¤æ˜“
    const { value: latestBlockhash } = await rpc.getLatestBlockhash().send();

    const transactionMessage = pipe(
        createTransactionMessage({ version: 0 }),
        tx => setTransactionMessageFeePayer(user1.address, tx),
        tx => setTransactionMessageLifetimeUsingBlockhash(latestBlockhash, tx),
        tx => appendTransactionMessageInstruction(
            getTransferSolInstruction({
                amount: lamports(LAMPORTS_PER_SOL / BigInt(2)),
                destination: user2.address,
                source: user1,
            }),
            tx
        )
    );

```

è®©æˆ‘ä»¬é€æ­¥åˆ†æï¼š

1. **RPC è°ƒç”¨å’Œ `.send()` æ–¹æ³•ï¼š**
æ–° SDK å¼•å…¥äº†ä¸€ç§ä¸€è‡´çš„æ¨¡å¼æ¥ä½¿ç”¨ `.send()` æ–¹æ³•è¿›è¡Œ RPC è°ƒç”¨ã€‚è¿™åœ¨ `getLatestBlockhash()` è°ƒç”¨ä¸­éå¸¸æ˜æ˜¾ï¼š

```codeBlockLines_e6Vv
const { value: latestBlockhash } = await rpc.getLatestBlockhash().send();

```

è¿™ç§æ¨¡å¼å°† RPC è¯·æ±‚çš„æ„å»ºä¸å…¶æ‰§è¡Œåˆ†å¼€ï¼Œä½¿å¾—åœ¨å‘èµ·è¯·æ±‚æ—¶æ›´åŠ çµæ´»å’Œå¯ç»„åˆã€‚

2. **ä½¿ç”¨ç®¡é“è¿›è¡Œäº¤æ˜“æ„å»ºï¼š**
`pipe` å‡½æ•°æ˜¯æ–° SDK ä¸­ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œå€Ÿé‰´äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ç®¡é“ï¼Œå®ƒä»¬å…è®¸ä½ å°†å¤šä¸ªæ“ä½œé“¾æ¥åœ¨ä¸€èµ·ï¼Œå°†æ¯æ¬¡æ“ä½œçš„ç»“æœä½œä¸ºè¾“å…¥ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ“ä½œã€‚

```codeBlockLines_e6Vv
const transactionMessage = pipe(
       createTransactionMessage({ version: 0 }),
       tx => setTransactionMessageFeePayer(user1.address, tx),
       // ... æ›´å¤šæ“ä½œ
);

```

ç®¡é“ä¸­çš„æ¯ä¸ªå‡½æ•°å°†å‰ä¸€ä¸ªå‡½æ•°çš„ç»“æœä½œä¸ºå…¶è¾“å…¥ï¼Œé€æ­¥ä¿®æ”¹äº¤æ˜“æ¶ˆæ¯ã€‚è¿™ç§æ–¹æ³•ä½¿å¾—äº¤æ˜“æ„å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ä¸”æ˜“äºç»´æŠ¤ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤æ‚çš„äº¤æ˜“ã€‚

3. **æ¥è‡ªå•ç‹¬åº“çš„ç¨‹åºæŒ‡ä»¤ï¼š**
`getTransferSolInstruction` å‡½æ•°ä» `@solana-program/system` åº“å¯¼å…¥ï¼š

```codeBlockLines_e6Vv
import { getTransferSolInstruction } from "@solana-program/system";

```

å°†ç¨‹åºç‰¹å®šæŒ‡ä»¤åˆ†éš”åˆ°è‡ªå·±çš„åº“ä¸­æ˜¯ Web3.js 2.0 ä¸­çš„ä¸€ç§æ–°æ¨¡å¼ã€‚è¿™æœ‰åŠ©äºæ›´å¥½çš„ä»£ç ç»„ç»‡å’Œå¯¹ä¸åŒ Solana ç¨‹åºçš„ç®¡ç†ã€‚ä½ å¯ä»¥æœŸå¾…çœ‹åˆ°æ›´å¤šç¨‹åºç‰¹å®šåº“éµå¾ªè¿™ä¸€æ¨¡å¼ï¼Œä»è€Œä½¿ä¸å„ç§ Solana ç¨‹åºçš„äº¤äº’æ›´åŠ ç®€å•ã€‚

4. **ç»†åŒ–çš„äº¤æ˜“æ„å»ºï¼š**
æ³¨æ„äº¤æ˜“æ˜¯å¦‚ä½•é€æ­¥ç»„è£…çš„ï¼š

   - `createTransactionMessage({ version: 0 })`: åˆå§‹åŒ–æ–°çš„äº¤æ˜“æ¶ˆæ¯ã€‚
   - `setTransactionMessageFeePayer`: è®¾ç½®äº¤æ˜“çš„æ‰‹ç»­è´¹æ”¯ä»˜è€…ã€‚
   - `setTransactionMessageLifetimeUsingBlockhash`: ä½¿ç”¨æœ€è¿‘çš„åŒºå—å“ˆå¸Œè®¾ç½®äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸã€‚
   - `appendTransactionMessageInstruction`: å°†è½¬è´¦æŒ‡ä»¤æ·»åŠ åˆ°äº¤æ˜“ä¸­ã€‚

è¿™ç§ç»†åŒ–çš„æ–¹æ³•ä½¿å¼€å‘äººå‘˜å¯ä»¥æ›´å¥½åœ°æ§åˆ¶äº¤æ˜“çš„æ¯ä¸ªæ–¹é¢ï¼Œå¹¶ä½¿å¾—æ„å»ºå¸¦æœ‰å¤šæ¡æŒ‡ä»¤çš„å¤æ‚äº¤æ˜“å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

5. **ç±»å‹å®‰å…¨å’Œä¸å¯å˜æ€§ï¼š**
é€šè¿‡ä¸ºäº¤æ˜“æ„å»ºçš„æ¯ä¸ªæ­¥éª¤ä½¿ç”¨å•ç‹¬çš„å‡½æ•°ï¼Œç»“åˆ TypeScriptï¼Œæé«˜äº†ç±»å‹å®‰å…¨æ€§ï¼Œç¡®ä¿å°½æ—©æ•è·é”™è¯¯ã€‚æ¯ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„äº¤æ˜“å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰å¯¹è±¡ï¼Œä¿ƒè¿›ä¸å¯å˜æ€§å¹¶å‡å°‘æ„å¤–å‰¯ä½œç”¨çš„å¯èƒ½æ€§ã€‚

åˆ©ç”¨è¿™äº›ç‰¹æ€§ï¼Œæ–° Solana Web3.js 2.0 SDK æ—¨åœ¨æä¾›ä¸€ç§æ›´å¼ºå¤§ã€çµæ´»å’Œå¼€å‘è€…å‹å¥½çš„ä¸ Solana åŒºå—é“¾äº¤äº’çš„æ–¹å¼ã€‚å½“ä½ ç»§ç»­ä½¿ç”¨ SDK æ—¶ï¼Œä½ ä¼šå‘ç°è¿™äº›æ¨¡å¼ä½¿ç¼–å†™æ¸…æ™°ã€å¯ç»´æŠ¤å’ŒæŠ—é”™è¯¯çš„ Solana åº”ç”¨ç¨‹åºä»£ç å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

## ç­¾åå¹¶å‘é€äº¤æ˜“  

```codeBlockLines_e6Vv
    // 5 - ç­¾åå¹¶å‘é€äº¤æ˜“
    const signedTransaction = await signTransactionMessageWithSigners(transactionMessage);
    const sendAndConfirmTransaction = sendAndConfirmTransactionFactory({ rpc, rpcSubscriptions });

    try {
        await sendAndConfirmTransaction(
            signedTransaction,
            { commitment: 'confirmed', skipPreflight: true }
        );
        const signature = getSignatureFromTransaction(signedTransaction);
        console.log('âœ… - è½¬è´¦äº¤æ˜“:', signature);
    } catch (e) {
        console.error('è½¬è´¦å¤±è´¥:', e);
    }

```

æœ¬èŠ‚å±•ç¤ºäº† Web3.js 2.0 çš„å‡ ä¸ªå…³é”®ç‰¹æ€§ï¼š

1. æˆ‘ä»¬ä½¿ç”¨ `signTransactionMessageWithSigners` ä½¿ç”¨å¯èƒ½å­˜å‚¨åœ¨æŒ‡ä»¤è´¦æˆ·çš„è´¦æˆ·å…ƒæ•°æ®ä¸­çš„ä»»ä½•ç­¾åè€…æ¥ç­¾åæˆ‘ä»¬çš„äº¤æ˜“ã€‚å¦‚æœä½ å›é¡¾æˆ‘ä»¬çš„ `getTransferSolInstruction` å‡½æ•°ï¼Œä½ ä¼šçœ‹åˆ°åœ¨ `source` å‚æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥ `user1` å¯†é’¥å¯¹ï¼ˆæºè´¦æˆ·çš„ç­¾åè€…ï¼‰ã€‚ç„¶åï¼Œ`signTransactionMessageWithSigners` å°†ä½¿ç”¨è¯¥ç­¾åè€…å¯¹äº¤æ˜“è¿›è¡Œç­¾åã€‚
2. æˆ‘ä»¬ä½¿ç”¨ `sendAndConfirmTransactionFactory` å‡½æ•°åˆ›å»ºä¸€ä¸ª `sendAndConfirmTransaction` å‡½æ•°ã€‚
3. æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ `sendAndConfirmTransaction` å‡½æ•°å‘é€å·²ç­¾åçš„äº¤æ˜“ï¼Œå¹¶è¿”å›äº¤æ˜“ç­¾åï¼Œè¯¥ç­¾åæ˜¯é€šè¿‡ `getSignatureFromTransaction` å‡½æ•°è·å¾—çš„ã€‚

## è®¾ç½®æœ¬åœ°ç¯å¢ƒ 

å¯¹äºæœ¬æŒ‡å—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæœ¬åœ° Solana éªŒè¯å™¨ã€‚æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£å¹¶å¯åŠ¨éªŒè¯å™¨ï¼š

```codeBlockLines_e6Vv
solana-test-validator -r

```

## è¿è¡Œè„šæœ¬  

è¦è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```codeBlockLines_e6Vv
ts-node transfer.ts

```

ä½ åº”è¯¥ä¼šçœ‹åˆ°æŒ‡ç¤ºæˆåŠŸè¿æ¥ã€ç©ºæŠ•å’Œè½¬è´¦äº¤æ˜“çš„è¾“å‡ºï¼š

![transfer.ts çš„è¾“å‡º](https://img.learnblockchain.cn/attachments/migrate/1737077886998)

åšå¾—å¥½ï¼

## æ·»åŠ æ›´å¤šæŒ‡ä»¤ 

å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥éšæ„å°†é™„åŠ æŒ‡ä»¤é™„åŠ åˆ°è½¬è´¦äº¤æ˜“ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ `pipe` ä¸­æ·»åŠ ä»¥ä¸‹æŒ‡ä»¤ï¼Œä»¥å‘å¦ä¸€ä¸ªè´¦æˆ·è½¬è´¦ SOLï¼š

```codeBlockLines_e6Vv
        tx => appendTransactionMessageInstruction(
            getTransferSolInstruction({
                amount: lamports(LAMPORTS_PER_SOL / BigInt(3)),
                destination: address('SOME_OTHER_ADDRESS'),
                source: user1,
            }),
            tx
        )

```

ç»ƒä¹ æ˜¯æå‡æŠ€èƒ½çš„æœ€ä½³æ–¹å¼ï¼Œå› æ­¤è¯·éšæ„å°è¯•ä¸åŒçš„æŒ‡ä»¤å’Œäº¤æ˜“ã€‚ å¦‚æœä½ æƒ³æŸ¥çœ‹æœ¬æŒ‡å—çš„æºä»£ç ï¼Œå¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/quiknode-labs/qn-guide-examples/tree/main/solana/web3.js-2.0/basics)æ‰¾åˆ°å®ƒã€‚
ç¥ç¼–ç æ„‰å¿«ï¼

## æ€»ç»“  

æœ¬æŒ‡å—é€šè¿‡åˆ›å»ºä¸€ä¸ªè„šæœ¬ä»¥æ‰§è¡ŒåŸºæœ¬è½¬è´¦äº¤æ˜“ï¼Œæ¢ç´¢äº†æ–°çš„ Solana Web3.js 2.0 åº“ã€‚é€šè¿‡å…¶å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å’Œå·¥å‚å‡½æ•°çš„ä½¿ç”¨ï¼Œæ–°çš„ API ä¿ƒè¿›äº†æ¨¡å—åŒ–ã€å¯ç»„åˆæ€§å’Œæé«˜çš„å¼€å‘è€…ä½“éªŒã€‚

ä¸€äº›å…³é”®è¦ç‚¹ï¼š

1. æ–°çš„ API å…è®¸å¯¹äº¤æ˜“åˆ›å»ºå’Œç­¾åè¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚
2. å·¥å‚å‡½æ•°æä¾›äº†ä¸€ç§åˆ›å»ºå¯é‡ç”¨å’Œå¯å®šåˆ¶å‡½æ•°çš„æ–¹æ³•ã€‚
3. `pipe` å‡½æ•°å…è®¸æ“ä½œçš„æ¸…æ™°å’Œå¯è¯»çš„ç»„åˆã€‚

éšç€ä½ ç»§ç»­æ¢ç´¢ Web3.js 2.0ï¼Œä½ å°†å‘ç°æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½å’Œæ”¹è¿›ã€‚ç¥ç¼–ç æ„‰å¿«ï¼
 

## èµ„æº  

- [æœ¬æŒ‡å—çš„ç¤ºä¾‹ä»£ç ](https://github.com/quiknode-labs/qn-guide-examples/tree/main/solana/web3.js-2.0/basics)
- [åšå®¢ï¼šSolana Web3.js 2.0 ä¸­çš„æ–°å†…å®¹](https://blog.quicknode.com/solana-web3-js-2-0-a-new-chapter-in-solana-development/)
- [Solana Web3.js 2.0 ç¤ºä¾‹](https://github.com/solana-labs/solana-web3.js/tree/master/examples)
- [Solana Web3.js 2.0 GitHub](https://github.com/solana-labs/solana-web3.js)
- [Solana Web3.js é‡å†™åŸåˆ™](https://github.com/solana-labs/solana-web3.js/issues/1111)
- [ğŸ¥ ä»‹ç»æ–°çš„ Solana Web3.js 2.0 SDK](https://www.youtube.com/watch?v=JUJtAPhES5g)

- [æ¦‚è¿°](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#overview)
  - [ä½ å°†è¦åšä»€ä¹ˆ](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#what-you-will-do)
  - [ä½ å°†éœ€è¦ä»€ä¹ˆ](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#what-you-will-need)
- [ä»€ä¹ˆæ˜¯ Solana Web3.js 2.0?](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#what-is-solana-web3js-20)
- [åˆ›å»ºæ–°é¡¹ç›®](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#create-a-new-project)
- [å¯¼å…¥ä¾èµ–](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#import-dependencies)
- [åˆ›å»ºä¸»å‡½æ•°](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#create-the-main-function)
- [å»ºç«‹ä¸ Solana é›†ç¾¤çš„è¿æ¥](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#establish-connection-to-solana-cluster)
- [ç”Ÿæˆç­¾åè€…](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#generate-signers)
- [å‘è´¦æˆ·ç©ºæŠ• SOL](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#airdrop-sol-to-accounts)
- [åˆ›å»ºå¹¶å‘é€è½¬è´¦äº¤æ˜“](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#create-and-send-transfer-transaction)
- [ç­¾åå¹¶å‘é€äº¤æ˜“](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#sign-and-send-transaction)
- [è®¾ç½®æœ¬åœ°ç¯å¢ƒ](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#set-up-local-environment)
- [è¿è¡Œè„šæœ¬](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#run-the-script)
- [æ·»åŠ æ›´å¤šæŒ‡ä»¤](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#add-more-instructions)
- [æ€»ç»“](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#wrap-up)
- [èµ„æº](https://www.quicknode.com/guides/solana-development/tooling/web3-2/transfer-sol#resources)

> æˆ‘æ˜¯ [AI ç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œåœ¨[è¿™é‡Œ](https://github.com/lbc-team/Pioneer/blob/master/translations/10622.md)ä¿®æ”¹ï¼Œè¿˜è¯·åŒ…æ¶µï½