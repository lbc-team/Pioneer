
>- åŸæ–‡é“¾æ¥ï¼š[zk.bearblog.dev/introduction](https://zk.bearblog.dev/introduction/)
>- è¯‘è€…ï¼š[AIç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œæ ¡å¯¹ï¼š[ç¿»è¯‘å°ç»„](https://learnblockchain.cn/people/412)
>- æœ¬æ–‡é“¾æ¥ï¼š[learnblockchain.cn/articleâ€¦](https://learnblockchain.cn/article/10274)
    
## å‰¥å¼€é›¶çŸ¥è¯†æ´‹è‘±

_2024 å¹´ 11 æœˆ 27 æ—¥_

![zk-blog-header](https://img.learnblockchain.cn/attachments/migrate/1734333625701)

> æœ¬æ–‡ç”±ä¸€ä½å·¥ç¨‹å¸ˆçˆ±å¥½è€…æ’°å†™ï¼ˆå—¨ï¼Œæˆ‘æ˜¯ [Krishang](https://zk.bearblog.dev/about/) ğŸ‘‹ğŸ½ï¼‰ï¼Œä¸ºåŒæ ·çš„å·¥ç¨‹å¸ˆå’Œçˆ±å¥½è€…ä»¬ã€‚
> 
> æ–‡ç« ä¸»è¦åŸºäºæˆ‘å¯¹ [_RareSkills ZK Book_](https://www.rareskills.io/zk-book) çš„é˜…è¯»ï¼Œä»¥åŠ [zksecurity](https://www.zksecurity.xyz/) çš„æ–‡ç« ã€[é‡å»º Tornado Cash](https://github.com/nkrishang/tornado-cash-rebuilt) å’Œå…¶ä»–ç›¸å…³æ¢ç´¢ã€‚

æœ¬æ–‡ä»‹ç»äº†é›¶çŸ¥è¯†ï¼ˆZKï¼‰ï¼Œä½¿ä½ å…·å¤‡è¶³å¤Ÿçš„æ¦‚å¿µçŸ¥è¯†ï¼Œä»¥ä¾¿æ¢ç´¢å·¥å…·å¹¶æ„å»ºé¡¹ç›®ï¼Œè€Œä¸ä¼šæ„Ÿåˆ°å®Œå…¨åƒä¸ªè§’è‰²æ‰®æ¼”è€…ï¼ˆLARPï¼‰ã€‚

æˆ‘ä»¬å°†é€‚åº¦å‰¥å¼€é›¶çŸ¥è¯†æ´‹è‘±ï¼Œè®©ä½ æ„Ÿåˆ°â€œå“¦ï¼Œè¿™å°±æ˜¯å®ƒçš„çœŸæ­£å«ä¹‰â€ï¼Œè€Œä¸ä¼šç”¨ä½ å¹¶ä¸çœŸæ­£*éœ€è¦*äº†è§£çš„æ•°å­¦å“åˆ°ä½ ï¼ˆä½†ä½ å¯ä»¥é€‰æ‹©åœ¨ä¹‹åè‡ªè¡Œæ¢ç´¢ï¼‰ã€‚

## é«˜çº§ä»‹ç»

åœ¨â€œé›¶çŸ¥è¯†è¯æ˜â€ä¸­æ¶‰åŠä¸¤ä¸ªå‚ä¸æ–¹â€”â€”_è¯æ˜è€…_å’Œ_éªŒè¯è€…_ã€‚

* * *

_è¯æ˜è€…_ï¼š

1. çŸ¥é“ä¸€äº›æ•°æ® d
2. æ»¡è¶³ä¸€ç»„çº¦æŸ C
3. é€šè¿‡å¦ä¸€ç»„æ•°æ® Pd è¯æ˜ä»–å¯¹è¯¥æ•°æ®çš„çŸ¥è¯†ã€‚

_éªŒè¯è€…_ï¼š

1. çŸ¥é“ä¸€ç»„çº¦æŸ C
2. ä»_è¯æ˜è€…_é‚£é‡Œæ¥æ”¶æ•°æ® Pd
3. æ— æ³•ä» Pd ä¸­æ£€ç´¢åŸå§‹æ•°æ® d
4. ä½†å¯ä»¥æ£€æŸ¥ Pdï¼Œä»¥éªŒè¯_è¯æ˜è€…_çŸ¥é“ä¸€äº›æ»¡è¶³çº¦æŸ C çš„æ•°æ® dã€‚

* * *

å› æ­¤ï¼Œâ€œé›¶çŸ¥è¯†è¯æ˜â€**ç®—æ³•**æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œå…è®¸_è¯æ˜è€…_è¯´æœ_éªŒè¯è€…_ï¼Œè®©ä»–ç›¸ä¿¡ä»–çŸ¥é“ä¸€äº›æ»¡è¶³ç»™å®šçº¦æŸçš„ç‰¹å®šæ•°æ®ï¼Œè€Œä¸é€éœ²è¯¥æ•°æ®æœ¬èº«ã€‚

â€œé›¶çŸ¥è¯†â€**è¯æ˜**æ˜¯_è¯æ˜è€…_å‘_éªŒè¯è€…_æä¾›çš„æ•°æ®ï¼Œ_éªŒè¯è€…_å¯ä»¥æ£€æŸ¥è¿™äº›æ•°æ®ï¼Œä»¥ç¡®å®š_è¯æ˜è€…_æ˜¯å¦è¯šå®åœ°å£°æ˜ä»–å¯¹åŸå§‹æœªé€éœ²æ•°æ®çš„çŸ¥è¯†ã€‚

ä½¿è¿™ä¸ªè¿‡ç¨‹**é›¶çŸ¥è¯†**çš„åŸå› åœ¨äºï¼Œ_è¯æ˜è€…_ä»æœªå‘ä»»ä½•äººé€éœ²åŸå§‹æ•°æ® dï¼Œä»¥è¯æ˜ä»–çŸ¥é“ dã€‚

## æ­£å¼ä»‹ç»

æ•°æ® d æ˜¯ç‰¹æ®Šçš„ï¼Œå› ä¸ºå®ƒæ»¡è¶³_è¯æ˜è€…_å’Œ_éªŒè¯è€…_éƒ½å…³å¿ƒçš„ä¸€ç»„çº¦æŸ Cã€‚è¿™ç»„çº¦æŸå¯ä»¥è¢«è§†ä¸ºå¯¹æŸäº›æ•°æ®çš„æè¿°ï¼Œè€Œå¯¹å…¶ä»–æ•°æ®åˆ™ä¸æˆç«‹ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¦æŸå¯ä»¥ç®€å•åœ°è¡¨ç¤ºä¸ºï¼šaÃ—b=42

è¿™ä¸ªçº¦æŸå®é™…ä¸Šæ˜¯å¯¹æ‰€æœ‰ä¹˜ç§¯ä¸º 42 çš„å¯¹ (a,b) çš„æè¿°ã€‚å°½ç®¡è¿™ä¸ªä¾‹å­éå¸¸ç®€å•ä¸”æ˜¯è™šæ„çš„ï¼Œä½†å®ƒæ•æ‰äº†ä¸€ä¸ªæ·±åˆ»çš„åŸåˆ™â€”â€”**ä¸€ç»„ç®—æœ¯çº¦æŸæ˜¯å¯¹ä¸€ç»„æ•°æ®çš„æè¿°â€”â€”ç‰¹åˆ«æ˜¯ï¼Œæ»¡è¶³è¿™äº›çº¦æŸçš„æ•°æ®é›†ã€‚**

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£é›¶çŸ¥è¯†è¯æ˜ä¸º_è¯æ˜è€…_è¯´æœ_éªŒè¯è€…_ï¼Œè®©ä»–ç›¸ä¿¡ä»–çŸ¥é“æŸä¸ªç‰¹å®šé›†åˆçš„æˆå‘˜ï¼Œè€Œä¸é€éœ²å…·ä½“æ˜¯å“ªä¸ªæˆå‘˜ã€‚

ä¸€ç»„ç®—æœ¯çº¦æŸæ˜¯ä¸€ä¸ªæ–¹ç¨‹ç»„ï¼š

1. z3+43=x2Â·y
2. yâˆ’22=x+3z
3. ... ä¾æ­¤ç±»æ¨

æ–¹ç¨‹ç»„çš„è§£æ˜¯æ‰€æœ‰å‡ºç°åœ¨æ–¹ç¨‹ä¸­çš„å˜é‡çš„å€¼åˆ†é…ï¼ˆä¾‹å¦‚ (x,y,z)=??ï¼‰ã€‚ä¸€ä¸ªæ–¹ç¨‹ç»„å¯ä»¥æ²¡æœ‰è§£ã€ä¸€ä¸ªè§£æˆ–å¤šä¸ªè§£ã€‚

é›¶çŸ¥è¯†è¯æ˜çš„ç›®çš„æ˜¯ä½¿_è¯æ˜è€…_èƒ½å¤Ÿè¯æ˜ä»–çŸ¥é“ä¸€ä¸ªæ–¹ç¨‹ç»„çš„å˜é‡ (v1,v2,...vn) çš„å€¼åˆ†é…ï¼Œè¯¥å€¼åˆ†é…æ»¡è¶³æ‰€æœ‰æ–¹ç¨‹ï¼Œè€Œä¸é€éœ²ç‰¹å®šçš„å€¼åˆ†é…ã€‚

åœ¨ä»»ä½•é›¶çŸ¥è¯†è¯æ˜çš„é«˜çº§åº”ç”¨ä¸­ï¼Œä¾‹å¦‚æ··åˆå™¨ï¼ˆTornado Cashï¼‰ã€zkVMã€ç§äººæŠ•ç¥¨ç­‰ï¼Œåœ¨ä½çº§åˆ«ä¸Šï¼Œéƒ½æœ‰ä¸€ä¸ªæ–¹ç¨‹ç»„æ¥ç¼–ç åº”ç”¨çš„é«˜çº§â€œé—®é¢˜â€ã€‚

## å®é™…ä»‹ç»

Tornado Cash çš„â€œé—®é¢˜â€æ˜¯è®©ä¸€ä¸ªè´¦æˆ·ï¼ˆAliceï¼‰å°† 1 ä¸ªä»¥å¤ªå¸å­˜å…¥å…¶æ™ºèƒ½åˆçº¦ï¼Œå¹¶å…è®¸å¦ä¸€ä¸ªè´¦æˆ·ï¼ˆBobï¼‰åœ¨ä¸åˆ›å»º Alice å’Œ Bob ä¹‹é—´ä»»ä½•å¯è¯†åˆ«å…³è”çš„æƒ…å†µä¸‹æå– Alice çš„å­˜æ¬¾ã€‚

![tornado-cash-diagram](https://img.learnblockchain.cn/attachments/migrate/1734333625824)

Tornado Cash é€šè¿‡è®©å­˜æ¬¾äººæäº¤ä¸€ä¸ª_æ‰¿è¯º_ä¸ä»–ä»¬çš„å­˜æ¬¾ä¸€èµ·æäº¤æ¥å®ç°è¿™ä¸€ç‚¹ã€‚è¿™ä¸ªæ‰¿è¯ºæ˜¯å°†ä¸¤ä¸ªå€¼å“ˆå¸Œåœ¨ä¸€èµ·çš„è¾“å‡ºã€‚

C=hash(n,s)

å…¶ä¸­ C è¢«ç§°ä¸º_æ‰¿è¯º_ï¼Œè€Œ n,sï¼ˆ_æ— æ•ˆå€¼_å’Œ_ç§˜å¯†_ï¼‰æ˜¯ä»…å­˜æ¬¾äººçŸ¥é“çš„ç§æœ‰å€¼ã€‚æ™ºèƒ½åˆçº¦ç°åœ¨åªä¼šåœ¨æå–è€…è¯æ˜ä»–ä»¬çŸ¥é“ n,s æ—¶é‡Šæ”¾è¯¥å­˜æ¬¾é‡‘é¢ã€‚

ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œå¦‚æœæå–è€…å¿…é¡»å‘æ™ºèƒ½åˆçº¦ç›´æ¥æˆ–é—´æ¥ä½†å¯æ¢å¤åœ°é€éœ² n,sï¼Œå°±ä¼šæœ‰å¯èƒ½åœ¨ç‰¹å®šå­˜æ¬¾å’Œæå–ä¹‹é—´åˆ›å»ºå…³è”ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä»æ‰€æœ‰å­˜æ¬¾ä¸­æŸ¥æ‰¾æ‰¿è¯ºå€¼ Cï¼Œå¹¶æ£€æŸ¥å“ªä¸ªæ»¡è¶³ C=hash(n,s)ã€‚

ä¸ºäº†é¿å…åœ¨å­˜æ¬¾å’Œæå–ä¹‹é—´åˆ›å»ºä»»ä½•å…³è”ï¼ŒTornado Cash ä½¿ç”¨é›¶çŸ¥è¯†è¯æ˜ç®—æ³• **Groth-16** å…è®¸æå–è€…è¯æ˜ä»–ä»¬çŸ¥é“ä¸ç‰¹å®šå­˜æ¬¾ç›¸å…³çš„æŸäº› n,sã€‚åœ¨è¿™é‡Œï¼Œæ™ºèƒ½åˆçº¦å……å½“_éªŒè¯è€…_ï¼Œè€Œæå–è€…å……å½“_è¯æ˜è€…_ã€‚

Tornado Cash äº 2019 å¹´é¦–æ¬¡æ¨å‡ºã€‚è‡ªé‚£æ—¶ä»¥æ¥ï¼ŒZK å·¥å…·ä¸æ–­å‘å±•ï¼Œä½¿å¾—åŸå§‹ä»£ç åº“æœ‰äº›è¿‡æ—¶ã€‚æˆ‘ä»¬å°†é€šè¿‡ [tornado-cash-rebuilt](https://github.com/nkrishang/tornado-cash-rebuilt) ä»“åº“è¿›è¡Œè®²è§£ï¼Œè¯¥ä»“åº“ä½¿ç”¨ç°ä»£ Solidity å’Œ ZK å·¥å…·é‡å»º Tornado Cash ä»¥ä¾›æ•™è‚²ç›®çš„ã€‚

[/circuits](https://github.com/nkrishang/tornado-cash-rebuilt/blob/main/circuits/withdraw.circom) ç›®å½•åŒ…å«ä½¿ç”¨ [Circom](https://docs.circom.io/) ç¼–å†™çš„ä»£ç ã€‚è¯¥ä»£ç å®šä¹‰äº†ç¼–ç æˆ‘ä»¬åˆšåˆšå­¦ä¹ çš„ Tornado Cash ä¸­å¿ƒâ€œé—®é¢˜â€çš„ç®—æœ¯çº¦æŸé›†ã€‚

ä»è¿™ä¸ªç”µè·¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç”Ÿæˆ [Verifier.sol](https://github.com/nkrishang/tornado-cash-rebuilt/blob/main/src/Verifier.sol) æ™ºèƒ½åˆçº¦ï¼Œè¯¥åˆçº¦å……å½“æŸä¸ªæ— æ•ˆå€¼ n å’Œç§˜å¯† s çš„ Groth-16 çŸ¥è¯†è¯æ˜çš„_éªŒè¯è€…_ï¼Œä½¿å¾— C=hash(n,s) å¯¹äºä¸å­˜æ¬¾ä¸€èµ·å‘é€åˆ° Tornado Cash æ™ºèƒ½åˆçº¦çš„æŸä¸ªæ‰¿è¯º C æˆç«‹ã€‚

æœ€åï¼Œ[ETHTornado.t.sol](https://github.com/nkrishang/tornado-cash-rebuilt/blob/main/test/ETHTornado.t.sol) æµ‹è¯•æ–‡ä»¶æ¼”ç¤ºäº†ä»¥ä¸‹çš„ç«¯åˆ°ç«¯æµç¨‹ï¼š

1. é€‰æ‹©ä¸€ä¸ªéšæœºçš„æ— æ•ˆå€¼ n å’Œç§˜å¯† sã€‚
2. ç”Ÿæˆæ‰¿è¯º C=hash(n,s) å¹¶ä½¿ç”¨å®ƒè¿›è¡Œå­˜æ¬¾ã€‚
3. ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜å¹¶ä½¿ç”¨å®ƒè¿›è¡Œæå–ã€‚

* * *

æœ¬æ–‡ä»‹ç»äº†é›¶çŸ¥è¯†çš„åŸºæœ¬æ¦‚å¿µï¼Œä½¿ä½ å…·å¤‡äº†è¶³å¤Ÿçš„æ¦‚å¿µçŸ¥è¯†ï¼Œç°åœ¨å¯ä»¥æ¢ç´¢å·¥å…·å¹¶æ„å»ºé¡¹ç›®ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åˆšåˆšå¼€å§‹å‰¥å¼€æ´‹è‘±ï¼Œè¿˜æœ‰è®¸å¤šå±‚éœ€è¦ç»§ç»­æ¢ç´¢ã€‚

> æˆ‘æ˜¯ [AI ç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œåœ¨[è¿™é‡Œ](https://github.com/lbc-team/Pioneer/blob/master/translations/10274.md)ä¿®æ”¹ï¼Œè¿˜è¯·åŒ…æ¶µï½