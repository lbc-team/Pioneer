
>- åŸæ–‡é“¾æ¥ï¼š[proxies.yacademy.dev/pages...](https://proxies.yacademy.dev/pages/Proxies-List/)
>- è¯‘è€…ï¼š[AIç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œæ ¡å¯¹ï¼š[ç¿»è¯‘å°ç»„](https://learnblockchain.cn/people/412)
>- æœ¬æ–‡é“¾æ¥ï¼š[learnblockchain.cn/articleâ€¦](https://learnblockchain.cn/article/10189)
    
## ä»£ç†

> Vitalik è¯´ï¼šâ€œè¦æœ‰ä»£ç†ï¼ï¼ˆLet there be Proxiesï¼‰â€

ä»£ç†ï¼ˆProxyï¼‰æœ¬èº«å¹¶ä¸æ˜¯å›ºæœ‰å¯å‡çº§çš„ï¼Œä½†ä»£ç†æ˜¯å‡ ä¹æ‰€æœ‰å¯å‡çº§ä»£ç†æ¨¡å¼çš„åŸºç¡€ã€‚å¯¹**ä»£ç†**åˆçº¦çš„è°ƒç”¨ä¼šé€šè¿‡`delegatecall` è½¬å‘åˆ°**å®ç°**åˆçº¦ã€‚**å®ç°**åˆçº¦ä¹Ÿç§°ä¸º**é€»è¾‘**åˆçº¦ã€‚

åœ¨ä¸€äº›å˜ä½“ä¸­ï¼Œåªæœ‰å½“è°ƒç”¨è€…åŒ¹é…â€œæ‰€æœ‰è€…â€åœ°å€æ—¶ï¼Œè°ƒç”¨æ‰ä¼šè¢«è½¬å‘åˆ°ä»£ç†ã€‚

**å®ç°åœ°å€** - åœ¨ä»£ç†åˆçº¦ä¸­æ˜¯ä¸å¯å˜çš„ã€‚

**å‡çº§é€»è¾‘** - çº¯ä»£ç†åˆçº¦ä¸­æ²¡æœ‰å¯å‡çº§æ€§ã€‚

**åˆçº¦éªŒè¯** - å¯ä¸ Etherscan ï¼ˆ [ç¤ºä¾‹](https://etherscan.io/address/0x09cabec1ead1c0ba254b09efb3ee13841712be14#readProxyContract) ï¼‰å’Œå…¶ä»–åŒºå—æµè§ˆå™¨é…åˆä½¿ç”¨ã€‚

### ç”¨ä¾‹

*   å½“éœ€è¦éƒ¨ç½²å¤šä¸ªä»£ç åŸºæœ¬ç›¸åŒçš„åˆçº¦æ—¶éå¸¸æœ‰ç”¨ã€‚

### ä¼˜ç‚¹

*   éƒ¨ç½²æˆæœ¬ä½ã€‚

### ç¼ºç‚¹

*   æ¯æ¬¡è°ƒç”¨ä¼šå¢åŠ ä¸€æ¬¡ `delegatecall` çš„è´¹ç”¨ã€‚

### ç¤ºä¾‹

*   [Uniswap V1 AMM æ± ](https://etherscan.io/address/0x09cabec1ead1c0ba254b09efb3ee13841712be14#code)
*   [Synthetix](https://github.com/Synthetixio/synthetix/pull/1191)

### å·²çŸ¥æ¼æ´

*   [å®ç°ä¸­ä¸å…è®¸ä½¿ç”¨ delegatecall å’Œ selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)

### å˜ä½“

*   [EIP-1167 æ ‡å‡†](https://eips.ethereum.org/EIPS/eip-1167)äº 2018 å¹´ 6 æœˆåˆ›å»ºï¼Œæ—¨åœ¨æ ‡å‡†åŒ–ä»¥ç®€å•ã€ä¾¿å®œä¸”ä¸å¯å˜çš„æ–¹å¼å…‹éš†åˆçº¦åŠŸèƒ½ã€‚è¯¥æ ‡å‡†åŒ…å«äº†é’ˆå¯¹ä»£ç†åˆçº¦ä¼˜åŒ–çš„æœ€å°å­—èŠ‚ç é‡å®šå‘å®ç°ã€‚é€šå¸¸ä¸[å·¥å‚æ¨¡å¼](https://github.com/optionality/clone-factory)ä¸€èµ·ä½¿ç”¨ã€‚

### æ·±å…¥é˜…è¯»

*   [é‡å¤–çš„æœ€å°ä»£ç†](https://blog.originprotocol.com/a-minimal-proxy-in-the-wild-ae3f7b8da990)
*   [OpenZeppelin æ ¸å¿ƒä»£ç†åˆçº¦](https://docs.openzeppelin.com/contracts/4.x/api/proxy#Proxy)
*   [æ·±å…¥ç ”ç©¶æœ€å°ä»£ç†åˆçº¦](https://blog.openzeppelin.com/deep-dive-into-the-minimal-proxy-contract/)

* * *

## å¯åˆå§‹åŒ–ä»£ç†

> â€œä½†æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨æ²¡æœ‰ `constructor()` çš„æƒ…å†µä¸‹å·¥ä½œï¼Ÿâ€

ç°ä»£çš„ä»£ç†å¤§å¤šæ•°éƒ½æ˜¯å¯åˆå§‹åŒ–çš„ã€‚ä½¿ç”¨ä»£ç†çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯åªéœ€éƒ¨ç½²ä¸€æ¬¡å®ç°åˆçº¦ï¼ˆå³é€»è¾‘åˆçº¦ï¼‰ï¼Œç„¶åå¯ä»¥éƒ¨ç½²å¤šä¸ªæŒ‡å‘å®ƒçš„ä»£ç†åˆçº¦ã€‚ç„¶è€Œï¼Œç¼ºç‚¹æ˜¯ä½ æ— æ³•åœ¨åˆ›å»ºæ–°ä»£ç†æ—¶ä½¿ç”¨å·²ç»éƒ¨ç½²çš„å®ç°åˆçº¦ä¸­çš„æ„é€ å‡½æ•°ã€‚

ç›¸åï¼Œä½¿ç”¨ `initialize()` å‡½æ•°æ¥è®¾ç½®åˆå§‹å­˜å‚¨å€¼ï¼š
```
        uint8 private _initialized;
    
        function initializer() external {
            require(msg.sender == owner);
            require(_initialized < 1);
            _initialized = 1;
    
            // è®¾ç½®ä¸€äº›çŠ¶æ€å˜é‡
            // åšåˆå§‹åŒ–å·¥ä½œ
        }
```

### ç”¨ä¾‹

*   ä»»ä½•éœ€è¦åœ¨ä»£ç†åˆçº¦éƒ¨ç½²æ—¶è®¾ç½®å­˜å‚¨çš„ä»£ç†ã€‚

### ä¼˜ç‚¹

*   å…è®¸åœ¨æ–°ä»£ç†éƒ¨ç½²æ—¶è®¾ç½®åˆå§‹å­˜å‚¨ã€‚

### ç¼ºç‚¹

*   æ˜“å—ä¸åˆå§‹åŒ–ç›¸å…³çš„æ”»å‡»ï¼Œå°¤å…¶æ˜¯æœªåˆå§‹åŒ–çš„ä»£ç†ã€‚

### ç¤ºä¾‹

*   æ­¤åŠŸèƒ½ä¸å¤§å¤šæ•°ç°ä»£ä»£ç†ç±»å‹ï¼ˆåŒ…æ‹¬ TPP å’Œ UUPSï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œé™¤éæ²¡æœ‰éœ€è¦åœ¨ä»£ç†éƒ¨ç½²æ—¶è®¾ç½®å­˜å‚¨çš„ç”¨ä¾‹ã€‚

### å·²çŸ¥æ¼æ´

*   [æœªåˆå§‹åŒ–çš„ä»£ç†](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/uninitialized/UUPS_Uninitialized)

### å˜ä½“

*   [å…‹éš†å·¥å‚åˆçº¦æ¨¡å‹](https://github.com/optionality/clone-factory) - åœ¨åˆ›å»ºäº‹åŠ¡ä¸­ä½¿ç”¨å…‹éš†åˆå§‹åŒ–ã€‚
*   [å…·æœ‰ä¸å¯å˜å‚æ•°çš„å…‹éš†](https://github.com/wighawag/clones-with-immutable-args) - å…è®¸åˆ›å»ºå…·æœ‰ä¸å¯å˜å‚æ•°çš„å…‹éš†åˆçº¦ï¼Œè¿™äº›å‚æ•°å­˜å‚¨åœ¨ä»£ç†åˆçº¦çš„ä»£ç åŒºåŸŸã€‚å½“è°ƒç”¨æ—¶ï¼Œå‚æ•°é™„åŠ åˆ° `delegatecall` çš„ calldata ä¸­ï¼Œå®ç°åˆçº¦å‡½æ•°éšåä» calldata ä¸­è¯»å–å‚æ•°ã€‚æ­¤æ¨¡å¼å¯ä»¥æ¶ˆé™¤ä½¿ç”¨åˆå§‹åŒ–å™¨çš„éœ€è¦ï¼Œä½†ç¼ºç‚¹æ˜¯å½“å‰[è¯¥åˆçº¦æ— æ³•åœ¨ Etherscan ä¸ŠéªŒè¯](https://twitter.com/boredGenius/status/1484713577961250821?s=20&t=5jbuvNruLIJlLRow1nKrMw) ã€‚

### æ·±å…¥é˜…è¯»

* [å¯åˆå§‹åŒ– - OZ](https://docs.openzeppelin.com/contracts/4.x/api/proxy#Initializable)

* * *

## å¯å‡çº§ä»£ç†

> äººä»¬è¯´ï¼šâ€œä½†æˆ‘ä»¬æƒ³å‡çº§æˆ‘ä»¬çš„ä¸å¯å˜åˆçº¦ï¼â€

å¯å‡çº§ä»£ç†ç±»ä¼¼äº[ä»£ç†](#ä»£ç†) ï¼Œåªä¸è¿‡å®ç°åˆçº¦åœ°å€æ˜¯å¯è®¾ç½®çš„ï¼Œå¹¶ä¿å­˜åœ¨ä»£ç†åˆçº¦ä¸­ã€‚ä»£ç†åˆçº¦è¿˜åŒ…å«æˆæƒçš„å‡çº§åŠŸèƒ½ã€‚ç¬¬ä¸€ä¸ªå¯å‡çº§ä»£ç†åˆçº¦ä¹‹ä¸€ç”± [Nick Johnson](https://twitter.com/nicksdjohnson) åœ¨ 2016 å¹´ç¼–å†™ã€‚

å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿˜å»ºè®®ä½¿ç”¨æŸç§å½¢å¼çš„è®¿é—®æ§åˆ¶ï¼Œä»¥åŒºåˆ†æ‹¥æœ‰è€…/è°ƒç”¨è€…å’Œæ‹¥æœ‰æƒé™å‡çº§åˆçº¦çš„ç®¡ç†å‘˜ã€‚

**å®ç°åœ°å€** - ä½äºä»£ç†å­˜å‚¨ä¸­ã€‚

**å‡çº§é€»è¾‘** - ä½äºä»£ç†åˆçº¦ä¸­ã€‚

**åˆçº¦éªŒè¯** - æ ¹æ®å…·ä½“å®ç°ï¼Œå¯èƒ½æ— æ³•ä¸åƒ Etherscan è¿™æ ·çš„åŒºå—æµè§ˆå™¨é…åˆä½¿ç”¨ã€‚

### ç”¨ä¾‹

*   ä¸€ä¸ªç®€çº¦çš„å‡çº§åˆçº¦ã€‚é€‚ç”¨äºå­¦ä¹ é¡¹ç›®ã€‚

### ä¼˜ç‚¹

*   é€šè¿‡ä½¿ç”¨[ä»£ç†](#ä»£ç†)é™ä½éƒ¨ç½²æˆæœ¬ã€‚
*   å®ç°åˆçº¦å¯ä»¥å‡çº§ã€‚

### ç¼ºç‚¹

*   æ˜“å—å­˜å‚¨å’ŒåŠŸèƒ½å†²çªçš„å½±å“ã€‚
*   å®‰å…¨æ€§ä½äºç°ä»£å¯¹æ‰‹ã€‚
*   æ¯æ¬¡è°ƒç”¨éƒ½è¦æ‰¿æ‹…æ¥è‡ª[ä»£ç†](#ä»£ç†)çš„ `delegatecall` è´¹ç”¨ã€‚

### ç¤ºä¾‹

*   è¿™ç§åŸºæœ¬é£æ ¼ç°åœ¨ä¸å†å¹¿æ³›ä½¿ç”¨ã€‚

### å·²çŸ¥æ¼æ´

*   [å®ç°ä¸­ä¸å…è®¸ä½¿ç”¨ delegatecall å’Œ selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)
*   [æœªåˆå§‹åŒ–çš„ä»£ç†](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/uninitialized/UUPS_Uninitialized)
*   [å­˜å‚¨å†²çª](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/storage_collision)
*   [åŠŸèƒ½å†²çª](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/function_clashing)

### æ·±å…¥é˜…è¯»

*   [ç¬¬ä¸€ä¸ªä»£ç†åˆçº¦](https://ethereum-blockchain-developer.com/110-upgrade-smart-contracts/05-proxy-nick-johnson/)
*   [ç¼–å†™å¯å‡çº§åˆçº¦](https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable)

* * *

## EIP-1967 å¯å‡çº§ä»£ç†

> è§£å†³å­˜å‚¨å†²çªçš„â€œè§£å†³æ–¹æ¡ˆâ€

è¿™ç±»ä¼¼äº [å¯å‡çº§ä»£ç†](#å¯å‡çº§ä»£ç†)  ï¼Œä½†é€šè¿‡ä½¿ç”¨[æ— ç»“æ„å­˜å‚¨æ¨¡å¼](https://docs.openzeppelin.com/upgrades-plugins/1.x/proxies#unstructured-storage-proxies)å‡å°‘å­˜å‚¨å†²çªçš„é£é™©ã€‚å®ƒ**ä¸**å°†å®ç°åˆçº¦åœ°å€å­˜å‚¨åœ¨æ§½ 0 æˆ–ä»»ä½•å…¶ä»–æ ‡å‡†å­˜å‚¨æ§½ä¸­ã€‚

ç›¸åï¼Œåœ°å€å­˜å‚¨åœ¨é¢„å…ˆå•†å®šçš„æ§½ä¸­ã€‚ä¾‹å¦‚ï¼Œ[OpenZeppelin åˆçº¦](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/v4.7.3/contracts/proxy/ERC1967/ERC1967Upgrade.sol)ä½¿ç”¨å­—ç¬¦ä¸²â€œeip1967.proxy.implementationâ€çš„ keccak-256 å“ˆå¸Œå€¼**å‡å» 1**ã€‚ç”±äºè¿™ä¸ªæ§½å¹¿æ³›ä½¿ç”¨ï¼ŒåŒºå—æµè§ˆå™¨å¯ä»¥è¯†åˆ«å¹¶å¤„ç†ä»£ç†çš„ä½¿ç”¨ã€‚

*å‡å» 1 æä¾›äº†é¢å¤–çš„å®‰å…¨æ€§ï¼Œå› ä¸ºæ²¡æœ‰å®ƒï¼Œå­˜å‚¨æ§½æœ‰ä¸€ä¸ªå·²çŸ¥çš„é¢„æ˜ åƒï¼Œä½†åœ¨å‡å» 1 ä¹‹åï¼Œé¢„æ˜ åƒæ˜¯æœªçŸ¥çš„ã€‚å¯¹äºå·²çŸ¥çš„é¢„æ˜ åƒï¼Œå­˜å‚¨æ§½å¯èƒ½ä¼šé€šè¿‡æ˜ å°„è¢«è¦†ç›–ï¼Œä¾‹å¦‚ï¼Œå…¶ä¸­å­˜å‚¨æ§½çš„é”®æ˜¯é€šè¿‡ keccak-256 å“ˆå¸Œç¡®å®šçš„ã€‚

[EIP-1967](https://eips.ethereum.org/EIPS/eip-1967) è¿˜æŒ‡å®šäº†ä¸€ä¸ªç”¨äºç®¡ç†å‘˜å­˜å‚¨ï¼ˆauthï¼‰çš„æ§½ï¼Œä»¥åŠå°†è¦è¯¦ç»†è®¨è®ºçš„ Beacon ä»£ç†ã€‚

**å®ç°åœ°å€** - ä½äºä»£ç†åˆçº¦ä¸­çš„å”¯ä¸€å­˜å‚¨æ§½ã€‚

**å‡çº§é€»è¾‘** - æ ¹æ®å®ç°è€Œæœ‰æ‰€ä¸åŒã€‚

**åˆçº¦éªŒè¯** - æ˜¯çš„ï¼Œå¤§å¤šæ•° EVM åŒºå—æµè§ˆå™¨æ”¯æŒå®ƒã€‚

### ç”¨ä¾‹

*   å½“ä½ éœ€è¦æ¯”åŸºæœ¬çš„ å¯å‡çº§ä»£ç† æ›´é«˜çš„å®‰å…¨æ€§æ—¶ã€‚

### ä¼˜ç‚¹

*   é™ä½å­˜å‚¨å†²çªçš„é£é™©ã€‚
*   åŒºå—æµè§ˆå™¨å…¼å®¹æ€§

### ç¼ºç‚¹

*   æ˜“å—å‡½æ•°å†²çªçš„å½±å“ã€‚
*   ä¸å¦‚ç°ä»£å¯¹æ‰‹å®‰å…¨ã€‚
*   æ¯æ¬¡è°ƒç”¨éƒ½ä¼šäº§ç”Ÿæ¥è‡ª [ä»£ç†](#ä»£ç†) çš„ `delegatecall` æˆæœ¬ã€‚

### ç¤ºä¾‹

*   å°½ç®¡ [EIP-1967](https://eips.ethereum.org/EIPS/eip-1967) å­˜å‚¨æ§½æ¨¡å¼å·²åœ¨å¤§å¤šæ•°ç°ä»£å¯å‡çº§ä»£ç†ç±»å‹ä¸­å¹¿æ³›é‡‡ç”¨ï¼Œä½†è¿™ç§ç®€å•çš„åˆçº¦åœ¨å®é™…ä¸­å¹¶ä¸åƒä¸€äº›è¾ƒæ–°çš„æ¨¡å¼å¦‚ [TPP](#transparent-proxy-tpp)ã€[UUPS](#universal-upgradeable-proxy-standard-uups) å’Œ [Beacon](#beacon-proxy) é‚£æ ·å¸¸è§ã€‚

### å·²çŸ¥æ¼æ´

*   [å®ç°ä¸­ä¸å…è®¸ delegatecall å’Œ selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)
*   [æœªåˆå§‹åŒ–çš„ä»£ç†](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/uninitialized/UUPS_Uninitialized)
*   [å‡½æ•°å†²çª](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/function_clashing/UUPS_functionClashing)

### è¿›ä¸€æ­¥é˜…è¯»

*   [EIP-1967 æ ‡å‡†ä»£ç†å­˜å‚¨æ§½](https://ethereum-blockchain-developer.com/110-upgrade-smart-contracts/09-eip-1967/)
*   [ä»£ç†å§”æ‰˜](https://fravoll.github.io/solidity-patterns/proxy_delegate.html)

* * *

## é€æ˜ä»£ç† (TPP)

> è§£å†³å‡½æ•°å†²çªçš„â€œè§£å†³æ–¹æ¡ˆâ€

è¿™ä¸ [å¯å‡çº§ä»£ç†](#å¯å‡çº§ä»£ç†) ç±»ä¼¼ï¼Œé€šå¸¸ç»“åˆ [EIP-1967](#eip-1967-upgradeable-proxy)ã€‚ä½†æ˜¯ï¼Œå¦‚æœè°ƒç”¨è€…æ˜¯ä»£ç†çš„ç®¡ç†å‘˜ï¼Œä»£ç†å°†ä¸ä¼šå§”æ‰˜ä»»ä½•è°ƒç”¨ï¼›å¦‚æœè°ƒç”¨è€…æ˜¯å…¶ä»–åœ°å€ï¼Œä»£ç†å°†å§‹ç»ˆå§”æ‰˜è°ƒç”¨ï¼Œå³ä½¿å‡½æ•°ç­¾åä¸ä»£ç†è‡ªå·±çš„æŸä¸ªå‡½æ•°åŒ¹é…ã€‚è¿™é€šå¸¸é€šè¿‡åƒ [OpenZeppelin](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/transparent/TransparentUpgradeableProxy.sol#L45-L51) ä¸­çš„ä¿®é¥°ç¬¦å®ç°ï¼š

```
    modifier ifAdmin() {
        if (msg.sender == _getAdmin()) {
            _;
        } else {
            _fallback(); // å°†è°ƒç”¨é‡å®šå‘åˆ°ä»£ç†
        }
    }
```

ä»¥åŠåœ¨ `fallback()` ä¸­çš„æ£€æŸ¥ï¼š

```
    require(msg.sender != _getAdmin(), "TransparentUpgradeableProxy: admin cannot fallback to proxy target");
```

**å®ç°åœ°å€** - ä½äºä»£ç†åˆçº¦ä¸­çš„å”¯ä¸€å­˜å‚¨æ§½ ([EIP-1967](#eip-1967-upgradeable-proxy))ã€‚

**å‡çº§é€»è¾‘** - ä½äºä»£ç†åˆçº¦ä¸­ï¼Œä½¿ç”¨ [ä¿®é¥°ç¬¦](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/transparent/TransparentUpgradeableProxy.sol#L45-L51) æ¥é‡æ–°è·¯ç”±éç®¡ç†å‘˜è°ƒç”¨è€…ã€‚

**åˆçº¦éªŒè¯** - æ˜¯çš„ï¼Œå¤§å¤šæ•° EVM åŒºå—æµè§ˆå™¨æ”¯æŒå®ƒã€‚

### ç”¨ä¾‹

*   è¿™ç§æ¨¡å¼å› å…¶å¯å‡çº§æ€§å’Œå¯¹æŸäº›å‡½æ•°å’Œå­˜å‚¨å†²çªæ¼æ´çš„ä¿æŠ¤è€Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚

### ä¼˜ç‚¹

*   æ¶ˆé™¤äº†ç®¡ç†å‘˜å‡½æ•°å†²çªçš„å¯èƒ½æ€§ï¼Œå› ä¸ºä»–ä»¬ä»æœªè¢«é‡å®šå‘åˆ°å®ç°åˆçº¦ã€‚
*   ç”±äºå‡çº§é€»è¾‘ä½äºä»£ç†ä¸Šï¼Œå¦‚æœä»£ç†å¤„äºæœªåˆå§‹åŒ–çŠ¶æ€æˆ–å®ç°åˆçº¦è¢«è‡ªæ¯ï¼Œåˆ™ä»ç„¶å¯ä»¥å°†å®ç°è®¾ç½®ä¸ºæ–°åœ°å€ã€‚
*   é™ä½äº†ç”±äºä½¿ç”¨ [EIP-1967](#eip-1967-upgradeable-proxy) å­˜å‚¨æ§½è€Œå¯¼è‡´çš„å­˜å‚¨å†²çªé£é™©ã€‚
*   åŒºå—æµè§ˆå™¨å…¼å®¹æ€§ã€‚

### ç¼ºç‚¹

*   æ¯æ¬¡è°ƒç”¨ä¸ä»…ä¼šäº§ç”Ÿæ¥è‡ª [ä»£ç†](#the-proxy) çš„ `delegatecall` çš„è¿è¡Œæ—¶ gas æˆæœ¬ï¼Œè¿˜ä¼šäº§ç”Ÿæ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦ä¸ºç®¡ç†å‘˜çš„ SLOAD æˆæœ¬ã€‚
*   ç”±äºå‡çº§é€»è¾‘ä½äºä»£ç†ä¸Šï¼Œå› æ­¤å­—èŠ‚ç æ›´å¤šï¼Œéƒ¨ç½²æˆæœ¬æ›´é«˜ã€‚

### ç¤ºä¾‹

*   [dYdX](https://github.com/dydxprotocol/perpetual/blob/99962cc62caed2376596da357a13f5c3d0ea5e59/contracts/protocol/PerpetualProxy.sol)
*   [USDC](https://github.com/centrehq/centre-tokens/tree/b42cf04b31639b8b05d53fea9995954d5f3659d9/contracts/upgradeability)
*   [Aztec](https://github.com/AztecProtocol/AZTEC/blob/cb78ba3ee32ad82234ac0fbed046333eb7f233cf/packages/protocol/contracts/AccountRegistry/AccountRegistryManager.sol#L62-L66)
*   [Github ä¸Šçš„æ•°ç™¾ä¸ªé¡¹ç›®](https://github.com/search?q=adminupgradeabilityproxy&type=Code)

### å·²çŸ¥æ¼æ´

*   [å®ç°ä¸­ä¸å…è®¸ delegatecall å’Œ selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)
*   [æœªåˆå§‹åŒ–çš„ä»£ç†](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/uninitialized/UUPS_Uninitialized)
*   [å­˜å‚¨å†²çª](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/storage_collision)

### è¿›ä¸€æ­¥é˜…è¯»

*   [é€æ˜ä»£ç†æ¨¡å¼](https://blog.openzeppelin.com/the-transparent-proxy-pattern/)

* * *

## é€šç”¨å¯å‡çº§ä»£ç†æ ‡å‡† (UUPS)

> å¦‚æœæˆ‘ä»¬å°†å‡çº§é€»è¾‘ç§»åˆ°å®ç°åˆçº¦å‘¢ï¼ŸğŸ¤”

[EIP-1822](https://eips.ethereum.org/EIPS/eip-1822) æè¿°äº†ä¸€ç§å¯å‡çº§ä»£ç†æ¨¡å¼çš„æ ‡å‡†ï¼Œå…¶ä¸­ `upgrade` é€»è¾‘å­˜å‚¨åœ¨å®ç°åˆçº¦ä¸­ã€‚è¿™æ ·ï¼Œå°±ä¸éœ€è¦åœ¨ä»£ç†çº§åˆ«æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼Œä»è€ŒèŠ‚çœ gasã€‚å®ƒè¿˜æ¶ˆé™¤äº†å®ç°åˆçº¦ä¸Šçš„å‡½æ•°ä¸ä»£ç†ä¸­çš„å‡çº§é€»è¾‘å†²çªçš„å¯èƒ½æ€§ã€‚

UUPS çš„ç¼ºç‚¹æ˜¯å®ƒè¢«è®¤ä¸ºæ¯” TPP æ›´å…·é£é™©ã€‚å¦‚æœä»£ç†æ²¡æœ‰æ­£ç¡®åˆå§‹åŒ–ï¼Œæˆ–è€…å®ç°åˆçº¦è¢«è‡ªæ¯ï¼Œåˆ™æ— æ³•ä¿å­˜ä»£ç†ï¼Œå› ä¸ºå‡çº§é€»è¾‘ä½äºå®ç°åˆçº¦ä¸Šã€‚

UUPS ä»£ç†åœ¨å‡çº§æ—¶è¿˜åŒ…å«ä¸€ä¸ªé¢å¤–çš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿æ–°çš„å®ç°åˆçº¦æ˜¯å¯å‡çº§çš„ã€‚

è¯¥ä»£ç†åˆçº¦é€šå¸¸ç»“åˆ [EIP-1967](#eip-1967-upgradeable-proxy)ã€‚

**å®ç°åœ°å€** - ä½äºä»£ç†åˆçº¦ä¸­çš„å”¯ä¸€å­˜å‚¨æ§½ ([EIP-1967](#eip-1967-upgradeable-proxy))ã€‚

**å‡çº§é€»è¾‘** - ä½äºå®ç°åˆçº¦ä¸­ã€‚

**åˆçº¦éªŒè¯** - æ˜¯çš„ï¼Œå¤§å¤šæ•° EVM åŒºå—æµè§ˆå™¨æ”¯æŒå®ƒã€‚

### ç”¨ä¾‹

*   ç›®å‰è¿™æ˜¯åè®®åœ¨éƒ¨ç½²å¯å‡çº§åˆçº¦æ—¶æœ€å¹¿æ³›ä½¿ç”¨çš„æ¨¡å¼ã€‚

### ä¼˜ç‚¹

*   æ¶ˆé™¤äº†å®ç°åˆçº¦ä¸Šçš„å‡½æ•°ä¸ä»£ç†åˆçº¦å†²çªçš„é£é™©ï¼Œå› ä¸ºå‡çº§é€»è¾‘ä½äºå®ç°åˆçº¦ä¸Šï¼Œä»£ç†ä¸Šé™¤äº† `fallback()` ä¹‹å¤–æ²¡æœ‰é€»è¾‘ï¼Œè¯¥é€»è¾‘å§”æ‰˜è°ƒç”¨åˆ°å®ç°åˆçº¦ã€‚
*   ä¸ TPP ç›¸æ¯”ï¼Œè¿è¡Œæ—¶ gas æˆæœ¬é™ä½ï¼Œå› ä¸ºä»£ç†ä¸éœ€è¦æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦ä¸ºç®¡ç†å‘˜ã€‚
*   éƒ¨ç½²æ–°ä»£ç†çš„æˆæœ¬é™ä½ï¼Œå› ä¸ºä»£ç†é™¤äº† `fallback()` ä¹‹å¤–ä¸åŒ…å«ä»»ä½•é€»è¾‘ã€‚
*   é™ä½äº†ç”±äºä½¿ç”¨ [EIP-1967](#eip-1967-upgradeable-proxy) å­˜å‚¨æ§½è€Œå¯¼è‡´çš„å­˜å‚¨å†²çªé£é™©ã€‚
*   åŒºå—æµè§ˆå™¨å…¼å®¹æ€§ã€‚

### ç¼ºç‚¹

*   ç”±äºå‡çº§é€»è¾‘å­˜åœ¨äºå®ç°åˆçº¦ä¸­ï¼Œå› æ­¤å¿…é¡»æ ¼å¤–å°å¿ƒï¼Œä»¥ç¡®ä¿å®ç°åˆçº¦ä¸èƒ½ `selfdestruct` æˆ–å› åˆå§‹åŒ–ä¸å½“è€Œå¤„äºä¸è‰¯çŠ¶æ€ã€‚å¦‚æœå®ç°åˆçº¦å‡ºç°é—®é¢˜ï¼Œåˆ™ä»£ç†æ— æ³•æ¢å¤ã€‚
*   ä»ç„¶ä¼šäº§ç”Ÿæ¥è‡ª [Proxy](#the-proxy) çš„ `delegatecall` æˆæœ¬ã€‚

### ç¤ºä¾‹

*   [Superfluid](https://github.com/superfluid-finance/protocol-monorepo)
*   [Synthetix](https://github.com/Synthetixio/synthetix-v3)
*   [Github ä¸Šæˆç™¾ä¸Šåƒä¸ªé¡¹ç›®](https://github.com/search?q=UUPSUpgradeable&type=code)

### å·²çŸ¥æ¼æ´

*   [æœªåˆå§‹åŒ–çš„ä»£ç†](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/uninitialized/UUPS_Uninitialized)
*   [å‡½æ•°å†²çª](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/function_clashing)
*   [Selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)

### è¿›ä¸€æ­¥é˜…è¯»

*   [EIP-1822](https://eips.ethereum.org/EIPS/eip-1822)
*   [ä½¿ç”¨ UUPS ä»£ç†æ¨¡å¼](https://blog.logrocket.com/using-uups-proxy-pattern-upgrade-smart-contracts/)
*   [ç”¨è¿™ä¸ªå°æŠ€å·§æ°¸ä¹…æ€§åœ°å›ºå®š UUPS ä»£ç†](https://iosiro.com/blog/openzeppelin-uups-proxy-vulnerability-disclosure)

* * *

## ä¿¡æ ‡ä»£ç†

> ä½ ä»£ç†ä¸­çš„ä¿¡æ ‡ï¼Œæ˜¯ä½ çš„å¿«ä¹è®©æˆ‘æ„Ÿåˆ°æƒŠè®¶å—ï¼ŸğŸ¤”

ç›®å‰è®¨è®ºçš„å¤§å¤šæ•°ä»£ç†å°†å®ç°åˆçº¦åœ°å€å­˜å‚¨åœ¨ä»£ç†åˆçº¦å­˜å‚¨ä¸­ã€‚ä¿¡æ ‡æ¨¡å¼ç”± [Dharma](https://github.com/dharma-eng/dharma-smart-wallet/blob/master/contracts/proxies/smart-wallet/UpgradeBeaconProxyV1.sol) äº 2019 å¹´æ¨å¹¿ï¼Œå®ƒå°†å®ç°åˆçº¦çš„åœ°å€å­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„â€œä¿¡æ ‡â€åˆçº¦ä¸­ã€‚ä¿¡æ ‡çš„åœ°å€ä½¿ç”¨ [EIP-1967](https://eips.ethereum.org/EIPS/eip-1967) å­˜å‚¨æ¨¡å¼å­˜å‚¨åœ¨ä»£ç†åˆçº¦ä¸­ã€‚

ä½¿ç”¨å…¶ä»–ç±»å‹çš„ä»£ç†æ—¶ï¼Œå½“å®ç°åˆçº¦å‡çº§æ—¶ï¼Œæ‰€æœ‰ä»£ç†éƒ½éœ€è¦æ›´æ–°ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ä¿¡æ ‡ä»£ç†æ—¶ï¼Œåªéœ€è¦æ›´æ–°ä¿¡æ ‡åˆçº¦æœ¬èº«ã€‚

ä»£ç†ä¸­çš„ä¿¡æ ‡åœ°å€ä»¥åŠä¿¡æ ‡ä¸Šçš„å®ç°åˆçº¦åœ°å€éƒ½å¯ä»¥ç”±ç®¡ç†å‘˜è®¾ç½®ã€‚è¿™åœ¨å¤„ç†éœ€è¦ä»¥ä¸åŒæ–¹å¼åˆ†ç»„çš„å¤§é‡ä»£ç†åˆçº¦æ—¶ï¼Œæä¾›äº†è®¸å¤šå¼ºå¤§çš„ç»„åˆã€‚

**å®ç°åœ°å€** - ä½äºä¿¡æ ‡åˆçº¦çš„å”¯ä¸€å­˜å‚¨æ§½ä¸­ã€‚ä¿¡æ ‡åœ°å€ä½äºä»£ç†åˆçº¦çš„å”¯ä¸€å­˜å‚¨æ§½ä¸­ã€‚

**å‡çº§é€»è¾‘** - å‡çº§é€»è¾‘é€šå¸¸å­˜åœ¨äºä¿¡æ ‡åˆçº¦ä¸­ã€‚

**åˆçº¦éªŒè¯** - æ˜¯çš„ï¼Œå¤§å¤šæ•° EVM åŒºå—æµè§ˆå™¨æ”¯æŒã€‚

### ç”¨ä¾‹

*   å¦‚æœä½ éœ€è¦å¤šä¸ªä»£ç†åˆçº¦ï¼Œå¯ä»¥é€šè¿‡å‡çº§ä¿¡æ ‡ä¸€æ¬¡æ€§å‡çº§æ‰€æœ‰ä»£ç†ã€‚
*   é€‚ç”¨äºæ¶‰åŠå¤§é‡åŸºäºå¤šä¸ªå®ç°åˆçº¦çš„ä»£ç†åˆçº¦çš„æƒ…å†µã€‚ä¿¡æ ‡ä»£ç†æ¨¡å¼å…è®¸åŒæ—¶æ›´æ–°å„ç§ä»£ç†ç»„ã€‚

### ä¼˜ç‚¹

*   æ›´å®¹æ˜“åŒæ—¶å‡çº§å¤šä¸ªä»£ç†åˆçº¦ã€‚

### ç¼ºç‚¹

*   ä»å­˜å‚¨ä¸­è·å–ä¿¡æ ‡åˆçº¦åœ°å€ã€è°ƒç”¨ä¿¡æ ‡åˆçº¦ï¼Œç„¶åå†ä»å­˜å‚¨ä¸­è·å–å®ç°åˆçº¦åœ°å€çš„ gas å¼€é”€ï¼Œè¿˜æœ‰ä½¿ç”¨ä»£ç†æ‰€éœ€çš„é¢å¤– gasã€‚
*   å¢åŠ äº†é¢å¤–çš„å¤æ‚æ€§ã€‚

### ç¤ºä¾‹

*   [USDC](https://polygonscan.com/address/0xb254554636a3ff52e8b2d0f06203921c137e10d5#code)
*   [Dharma](https://github.com/dharma-eng/dharma-smart-wallet/blob/master/contracts/proxies/smart-wallet/UpgradeBeaconProxyV1.sol)

### å·²çŸ¥æ¼æ´

*   [å®ç°ä¸­ä¸å…è®¸çš„ Delegatecall å’Œ selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)
*   [æœªåˆå§‹åŒ–çš„ä»£ç†](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/uninitialized/UUPS_Uninitialized)
*   [å‡½æ•°å†²çª](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/function_clashing)

### å˜ä½“

*   ä¸å˜çš„ä¿¡æ ‡åœ°å€ - ä¸ºèŠ‚çœ gasï¼Œå¯ä»¥å°†ä¿¡æ ‡åœ°å€åœ¨ä»£ç†åˆçº¦ä¸­è®¾ä¸ºä¸å¯å˜ã€‚å®ç°åˆçº¦ä»å¯ä»¥é€šè¿‡æ›´æ–°ä¿¡æ ‡è¿›è¡Œè®¾ç½®ã€‚
*   [æ— å­˜å‚¨å¯å‡çº§ä¿¡æ ‡ä»£ç†](https://forum.openzeppelin.com/t/a-more-gas-efficient-upgradeable-proxy-by-not-using-storage/4111) - åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä¿¡æ ‡åˆçº¦å¹¶ä¸åœ¨å­˜å‚¨ä¸­å­˜å‚¨å®ç°åˆçº¦åœ°å€ï¼Œè€Œæ˜¯å°†å…¶å­˜å‚¨åœ¨ä»£ç ä¸­ã€‚ä»£ç†åˆçº¦é€šè¿‡ `EXTCODECOPY` ç›´æ¥ä»ä¿¡æ ‡åŠ è½½å®ƒã€‚

### è¿›ä¸€æ­¥é˜…è¯»

*   [å¦‚ä½•åˆ›å»ºä¿¡æ ‡ä»£ç†](https://medium.com/coinmonks/how-to-create-a-beacon-proxy-3d55335f7353)
*   [Dharma](https://github.com/dharma-eng/dharma-smart-wallet/blob/master/contracts/proxies/smart-wallet/UpgradeBeaconProxyV1.sol)

* * *

## é’»çŸ³ä»£ç†

> â€œé’»çŸ³æ˜¯ä»£ç†æœ€å¥½çš„æœ‹å‹å—ï¼Ÿâ€

[EIP-2535](https://eips.ethereum.org/EIPS/eip-2535) â€œé’»çŸ³â€æ˜¯èƒ½å¤Ÿåœ¨éƒ¨ç½²åè¿›è¡Œå‡çº§/æ‰©å±•çš„æ¨¡å—åŒ–æ™ºèƒ½åˆçº¦ç³»ç»Ÿï¼Œå‡ ä¹æ²¡æœ‰å¤§å°é™åˆ¶ã€‚ä» EIPï¼š

> é’»çŸ³æ˜¯ä¸€ä¸ªå…·æœ‰å¤–éƒ¨å‡½æ•°çš„åˆçº¦ï¼Œè¿™äº›å‡½æ•°ç”±ç§°ä¸ºä¾§é¢çš„åˆçº¦æä¾›ã€‚ä¾§é¢æ˜¯å¯ä»¥å…±äº«å†…éƒ¨å‡½æ•°ã€åº“å’ŒçŠ¶æ€å˜é‡çš„ç‹¬ç«‹åˆçº¦ã€‚

é’»çŸ³æ¨¡å¼ç”±ä¸€ä¸ªä¸­å¤®çš„ Diamond.sol ä»£ç†åˆçº¦ç»„æˆã€‚é™¤äº†å…¶ä»–å­˜å‚¨å¤–ï¼Œè¯¥åˆçº¦åŒ…å«å¯ä»¥åœ¨ç§°ä¸ºä¾§é¢çš„å¤–éƒ¨åˆçº¦ä¸Šè°ƒç”¨çš„å‡½æ•°æ³¨å†Œè¡¨ã€‚

é’»çŸ³ä»£ç†ä½¿ç”¨ç‹¬ç‰¹è¯æ±‡çš„æœ¯è¯­è¡¨ï¼š

| é’»çŸ³æœ¯è¯­        | å®šä¹‰                          |
| ---------------- | ------------------------------- |
| é’»çŸ³(Diamond)            | ä»£ç†                           |
| ä¾§é¢(Facet)            | å®ç°                          |
| å‰Šå‡(Cut)            | å‡çº§                           |
| Loupe            | å§”æ‰˜å‡½æ•°åˆ—è¡¨                 |
| å®Œæˆçš„é’»çŸ³      | ä¸å¯å‡çº§                       |
| å•å‰Šå‡é’»çŸ³      | ç§»é™¤å‡çº§åŠŸèƒ½                   |

**åˆçº¦éªŒè¯** - åˆçº¦å¯ä»¥é€šè¿‡ä¸€ä¸ªåä¸º **Louper** çš„å·¥å…·åœ¨ Etherscan ä¸Šè¿›è¡ŒéªŒè¯ï¼ˆ [ç¤ºä¾‹](https://louper.dev/diamond/0x17525e4f4af59fbc29551bc4ece6ab60ed49ce31) ï¼‰ã€‚

### ç”¨ä¾‹

*   éœ€è¦æœ€é«˜å±‚çº§çš„å¯å‡çº§æ€§å’Œæ¨¡å—åŒ–äº’æ“ä½œæ€§çš„å¤æ‚ç³»ç»Ÿã€‚

### ä¼˜ç‚¹

*   æä¾›æ‰€éœ€åŠŸèƒ½çš„ç¨³å®šåˆçº¦åœ°å€ã€‚é€šè¿‡å•ä¸€åœ°å€å‘å‡ºäº‹ä»¶å¯ä»¥ç®€åŒ–äº‹ä»¶å¤„ç†ã€‚
*   å¯ä»¥ç”¨äºåˆ†è§£è¶…è¿‡ Spurious Dragon é™åˆ¶çš„å¤§å‹åˆçº¦ > 24kbã€‚

### ç¼ºç‚¹

*   åœ¨è·¯ç”±å‡½æ•°æ—¶è®¿é—®å­˜å‚¨éœ€è¦é¢å¤–çš„ gasã€‚
*   ç”±äºå¤æ‚æ€§ï¼Œå­˜å‚¨å†²çªçš„æœºä¼šå¢åŠ ã€‚
*   å½“éœ€è¦ç®€å•çš„å¯å‡çº§æ€§æ—¶ï¼Œå¤æ‚æ€§å¯èƒ½è¿‡å¤§ã€‚

### ç¤ºä¾‹

*   [Simple DeFi](https://www.simpledefi.io/)
*   [PartyFinance](https://party.finance/)
*   [ç¤ºä¾‹å®Œæ•´åˆ—è¡¨](https://github.com/mudgen/awesome-diamonds#projects-using-diamonds)ã€‚

### å·²çŸ¥æ¼æ´

*   [å®ç°ä¸­ä¸å…è®¸çš„ Delegatecall å’Œ selfdestruct](https://github.com/YAcademy-Residents/Solidity-Proxy-Playground/tree/main/src/delegatecall_with_selfdestruct/UUPS_selfdestruct)

### å˜ä½“

*   [vtable](https://github.com/OpenZeppelin/openzeppelin-labs/tree/master/upgradeability_with_vtable)
*   [å¦‚ä½•æ„å»ºæ— å¤§å°é™åˆ¶çš„åˆçº¦](https://twitter.com/ylv_io/status/1581639395064836102?s=20&t=WoHhqaSl8SlEdLUje5Cziw)

### è¿›ä¸€æ­¥é˜…è¯»

*   [å›ç­”ä¸€äº›å…³äº Diamond çš„é—®é¢˜](https://eip2535diamonds.substack.com/p/answering-some-diamond-questions)
*   [é»‘æš—æ£®æ—ä¸ Diamond æ ‡å‡†](https://blog.zkga.me/dark-forest-and-the-diamond-standard)
*   [å¥½ä¸»æ„ï¼Œç³Ÿç³•è®¾è®¡ã€‚Diamond æ ‡å‡†çš„ä¸è¶³ä¹‹å¤„](https://blog.trailofbits.com/2020/10/30/good-idea-bad-design-how-the-diamond-standard-falls-short/)
*   [è§£å†³ Josselin Feist å¯¹ EIP-2535 Diamonds çš„æ‹…å¿§](https://dev.to/mudgen/addressing-josselin-feist-s-concern-s-of-eip-2535-diamond-standard-me8)

* * *

> â€œcreate2, ä½¿ç”¨, selfdestruct, å†²æ´—, é‡å¤â€¦â€

å˜å½¢åˆçº¦ä¸æ‰€æœ‰å…¶ä»–å¯å‡çº§æ¨¡å¼çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸ä½¿ç”¨ä»£ç†ã€‚æ²¡æœ‰å¯¹å¤–éƒ¨é€»è¾‘åˆçº¦çš„ `delegatecall`ã€‚

å½“éœ€è¦å‡çº§æ—¶ï¼Œå˜å½¢åˆçº¦ä½¿ç”¨ `selfdestruct`ï¼Œå¹¶ä½¿ç”¨ `create2` å°†æ–°åˆçº¦éƒ¨ç½²åˆ°ç›¸åŒåœ°å€ã€‚

è¿™å¯ä»¥é€šè¿‡è®© initcode ä»ä¸€ä¸ªå•ç‹¬çš„å¤–éƒ¨åˆçº¦çš„å­˜å‚¨ä¸­æ£€ç´¢åˆ›å»ºä»£ç æ¥å®ç°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œinitcode å°†å§‹ç»ˆç›¸åŒï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ `create2` éƒ¨ç½²åˆ°ç›¸åŒåœ°å€ã€‚

ä¸å»ºè®®ä¸ºæ–°åˆçº¦ä½¿ç”¨å˜å½¢åˆçº¦ï¼Œå› ä¸º `selfdestruct` æ“ä½œç è®¡åˆ’åœ¨ä¸ä¹…çš„å°†æ¥ä»ä»¥å¤ªåŠä¸­ç§»é™¤ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ [EIP-4758](https://eips.ethereum.org/EIPS/eip-4758)ã€‚

**åˆçº¦éªŒè¯** - æ˜¯çš„ï¼Œå˜å½¢åˆçº¦å¯ä»¥è¢«éªŒè¯ã€‚

### ç”¨ä¾‹

*   ä»…åŒ…å«é€»è¾‘çš„åˆçº¦ï¼ˆç±»ä¼¼äº Solidity å¤–éƒ¨åº“ï¼‰ã€‚
*   çŠ¶æ€è¾ƒå°‘ä¸”ä¸é¢‘ç¹å˜åŒ–çš„åˆçº¦ï¼Œä¾‹å¦‚ä¿¡æ ‡ã€‚

### ä¼˜ç‚¹

*   ä¸éœ€è¦ä½¿ç”¨å¸¦æœ‰ `delegatecall` çš„ä»£ç†ã€‚
*   ä¸éœ€è¦ä½¿ç”¨ `initialize()` è€Œä¸æ˜¯ `constructor()`ã€‚

### ç¼ºç‚¹

*   å‡çº§æ—¶å­˜å‚¨ä¼šè¢«æ¸…é™¤ï¼Œå› ä¸ºä½¿ç”¨äº† `selfdestruct`ã€‚
*   ç”±äº `selfdestruct` åœ¨äº¤æ˜“ç»“æŸæ—¶æ¸…é™¤ä»£ç ï¼Œå› æ­¤å‡çº§éœ€è¦ä¸¤ç¬”äº¤æ˜“ï¼šä¸€ç¬”åˆ é™¤å½“å‰åˆçº¦ï¼Œå¦ä¸€ç¬”åˆ›å»ºæ–°åˆçº¦ã€‚åœ¨è¿™ä¸¤ç¬”äº¤æ˜“ä¹‹é—´åˆ°è¾¾æˆ‘ä»¬åˆçº¦çš„ä»»ä½•äº¤æ˜“éƒ½ä¼šå¤±è´¥ã€‚
*   `selfdestruct` æ“ä½œç å¯èƒ½åœ¨æœªæ¥è¢«ç§»é™¤ã€‚

### ç¤ºä¾‹

*   [0age çš„ç¤ºä¾‹åˆçº¦](https://github.com/0age/metamorphic#metamorphic)ã€‚
*   è¿™æ›´åƒæ˜¯ä¸€ç§å®éªŒç±»å‹ã€‚ä¸»è¦ç”¨äº MEV æœç´¢è€…ï¼ˆetherscan ç¤ºä¾‹ [åœ¨è¿™é‡Œ](https://etherscan.io/address/0x0000000000007f150bd6f54c40a34d7c3d5e9f56#code) å’Œ [åœ¨è¿™é‡Œ](https://etherscan.io/address/0x000000005736775feb0c8568e7dee77222a26880#code)ï¼‰ã€‚

### å·²çŸ¥æ¼æ´

*   ç”±äºä¸ä½¿ç”¨ä»£ç†æˆ–åˆå§‹åŒ–å™¨ï¼Œå› æ­¤ä¸æ˜“å—åˆ°å…¸å‹çš„å¯å‡çº§ä»£ç†æ¼æ´çš„æ”»å‡»ã€‚
*   åœ¨å‡çº§æ—¶å¯èƒ½ä¼šå—åˆ°æ”»å‡»ã€‚

### è¿›ä¸€æ­¥é˜…è¯»

*   [ä½¿ç”¨ CREATE2 çš„å˜å½¢æ™ºèƒ½åˆçº¦](https://ethereum-blockchain-developer.com/110-upgrade-smart-contracts/12-metamorphosis-create2/)
*   [å˜å½¢åˆçº¦çš„æ‰¿è¯ºä¸å±é™©](https://0age.medium.com/the-promise-and-the-peril-of-metamorphic-contracts-9eb8b8413c5e)
*   [a16z å˜å½¢åˆçº¦æ£€æµ‹å·¥å…·](https://a16zcrypto.com/metamorphic-smart-contract-detector-tool/)

> æˆ‘æ˜¯ [AI ç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œåœ¨[è¿™é‡Œ](https://github.com/lbc-team/Pioneer/blob/master/translations/10189.md)ä¿®æ”¹ï¼Œè¿˜è¯·åŒ…æ¶µï½