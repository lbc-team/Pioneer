
>- åŸæ–‡é“¾æ¥ï¼šhttps://extropy-io.medium.com/madara-quick-start-guide-48027ca5ed5b
>- è¯‘è€…ï¼š[AIç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œæ ¡å¯¹ï¼š[ç¿»è¯‘å°ç»„](https://learnblockchain.cn/people/412)
>- æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š[learnblockchain.cn/articleâ€¦](https://learnblockchain.cn/article/8697)
    
## Madaraå¿«é€Ÿå…¥é—¨æŒ‡å—

æ¬¢è¿æ¥åˆ°è¿™ä¸ªMadaraå¿«é€Ÿå…¥é—¨æŒ‡å—ï¼
Madara æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç æŠ€æœ¯æ ˆï¼Œè®©å¼€å‘è€…å¿«é€Ÿæ„å»ºåŸºäº Cairo å’Œ Starknet æŠ€æœ¯é©±åŠ¨çš„åº”ç”¨é“¾ã€‚

æœ¬æŒ‡å—å°†å¸¦ä½ å¿«é€Ÿè€Œè½»æ¾åœ°å¯åŠ¨å’Œéƒ¨ç½²åˆçº¦çš„MadaraèŠ‚ç‚¹ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## å¿…éœ€è½¯ä»¶

è¯·ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶

*   [rust](https://rustup.rs/)
*   [asdf](https://asdf-vm.com/guide/getting-started.html)
*   [starkli](https://book.starknet.io/ch02-01-basic-installation.html) 0.1.20 è¿™ä¸ªé¡µé¢è¿˜å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `asdf` å®‰è£…ä¸åŒç‰ˆæœ¬
*   [scarb](https://book.starknet.io/ch02-01-basic-installation.html#scarb-package-manager-installation) æ¨èä½¿ç”¨ `asdf` å®‰è£…
*   [node](https://nodejs.org/en/download) v.20.5.1 (å¯ä»¥ä½¿ç”¨ [asdf](https://github.com/asdf-vm/asdf-nodejs) æˆ– [nvm](https://github.com/nvm-sh/nvm) ç®¡ç†)

Linux ç”¨æˆ·å¯èƒ½éœ€è¦æ·»åŠ è¿™äº›ä¾èµ– `build-essential`, `libclang1`,`clang1`,`protobuf-compiler`

## ä»“åº“

ä½ å°†å…‹éš†è¿™ä¸¤ä¸ªä»“åº“

*   [Madara](https://github.com/keep-starknet-strange/madara/tree/main)
*   [Karnot/Madara](https://github.com/keep-starknet-strange/madara/tree/main)

**å…‹éš† [Madara ä»“åº“](https://github.com/keep-starknet-strange/madara/tree/main)**

é¦–å…ˆæ˜¯å…‹éš†ä»“åº“ã€‚

```
git clone git@github.com:keep-starknet-strange/madara.git
```

## å¯åŠ¨Madara

å…‹éš†åï¼Œä»è¿™ä¸ªæ–°å…‹éš†çš„ä»“åº“çš„ `madara` æ–‡ä»¶å¤¹å†…è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚å°† `/User/desmo/madara-state` æ›¿æ¢ä¸ºä½ æƒ³è¦å­˜å‚¨MadaraçŠ¶æ€çš„ä½ç½®ï¼š`/home/user/directory`

_æ³¨æ„_

è¿™äº›å‘½ä»¤ä¸Madaraä»“åº“ä¸­ç»™å‡ºçš„å‘½ä»¤ä¸åŒï¼Œå…è®¸æˆ‘ä»¬åœ¨æœ¬åœ°ä¿å­˜èŠ‚ç‚¹çŠ¶æ€ã€‚

```
cargo run --release -- setup --from-local ./configs/ --chain=dev --base-path=/Users/desmo/madara-state
```


```
cargo run --release -- --alice --base-path /Users/desmo/madara-state --rpc-cors=all --chain=dev

```

è¿™å°†å¯åŠ¨é“¾å¹¶æŒ‡å‘æˆ‘ä»¬å­˜å‚¨çŠ¶æ€çš„ä½ç½®ï¼Œä½ åº”è¯¥ç”¨å‰ä¸€ä¸ªå‘½ä»¤ä¸­ä½¿ç”¨çš„æ–‡ä»¶è·¯å¾„æ›¿æ¢æ–‡ä»¶è·¯å¾„ã€‚

å¦‚æœæˆåŠŸï¼Œä½ åº”è¯¥ä¼šå¾—åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š

```
Finished release [optimized] target(s) in 1.80s  
     Running \`target/release/madara --alice --base-path /Users/desmo/madara-state --rpc-cors=all --chain=dev\`  
2024-03-06 17:54:44 Madara initialized w/o DA layer      
2024-03-06 17:54:44 Madara initialized w/o settlement layer      
2024-03-06 17:54:44 Madara Node      
2024-03-06 17:54:44 âœŒï¸  version 0.7.0-5e68494fe9d      
2024-03-06 17:54:44 â¤ï¸  by Abdelhamid Bakhta <@keep-starknet-strange>:Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2024      
2024-03-06 17:54:44 ğŸ“‹ Chain specification: Development      
2024-03-06 17:54:44 ğŸ·  Node name: Alice      
2024-03-06 17:54:44 ğŸ‘¤ Role: AUTHORITY      
2024-03-06 17:54:44 ğŸ’¾ Database: RocksDb at /Users/desmo/madara-state/chains/dev/db/full      
2024-03-06 17:54:44 ğŸ§ª Using the following development accounts:      
2024-03-06 17:54:44 ğŸ§ª NO VALIDATE with address: 0x1 and no pk      
2024-03-06 17:54:44 ğŸ§ª ARGENT with address: 0x2 and pk: 0xc1cf1490de1352865301bb8705143f3ef938f97fdf892f1090dcb5ac7bcd1d      
2024-03-06 17:54:44 ğŸ§ª OZ with address: 0x3 and pk: 0xc1cf1490de1352865301bb8705143f3ef938f97fdf892f1090dcb5ac7bcd1d      
2024-03-06 17:54:44 ğŸ§ª CAIRO 1 with address: 0x4 and no pk      
2024-03-06 17:54:44 Using default protocol ID "sup" because none is configured in the chain specs      
2024-03-06 17:54:44 ğŸ·  Local node identity is: 12D3KooWLngNFrmtGSXsdWV8RG1aKbNs7dHrt8NfBmt9TCtHc4CY
```

## åˆ›å»ºæˆ‘ä»¬çš„åˆçº¦

ç°åœ¨æˆ‘ä»¬æˆåŠŸå¯åŠ¨äº†èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªåˆçº¦ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•åˆçº¦ï¼Œä½†è®©æˆ‘ä»¬ä» [Starknet by Example](https://starknet-by-example.voyager.online/ch00/basics/counter.html) å¼€å§‹ï¼Œä¸€ä¸ªè®¡æ•°å™¨åˆçº¦ï¼Œæˆ‘ä»¬å°†è¿›è¡Œä¸€äº›ç®€å•çš„ä¿®æ”¹ã€‚

### Scarb å‘½ä»¤

è®©æˆ‘ä»¬ä»ä½¿ç”¨ scarb åˆ›å»ºæˆ‘ä»¬çš„é¡¹ç›®å¼€å§‹

```
scarb new counter_contract
```



ç„¶åè¿›å…¥ä½ çš„ `counter_contract` å¹¶ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€ä½ æ–°åˆ›å»ºçš„é¡¹ç›®ã€‚

### ä¿®æ”¹ `scarb.toml`

æˆ‘ä»¬éœ€è¦å‘æˆ‘ä»¬çš„ `toml` æ–‡ä»¶ä¸­æ·»åŠ å‡ è¡Œä»¥ä½¿å…¶ä¸æˆ‘ä»¬çš„MadaraèŠ‚ç‚¹å…¼å®¹ã€‚

```
[package]  
name = "counter_contract"  
version = "0.1.0"  
# æŸ¥çœ‹æ›´å¤šé”®åŠå…¶å®šä¹‰ï¼Œè¯·è®¿é—® https://docs.swmansion.com/scarb/docs/reference/manifest.html  
[dependencies]  
starknet = ">=2.1.0"  
[[target.starknet-contract]]  
casm = true
```



### ä¿®æ”¹ `lib.rs`

å¦‚æœä½ æ­£åœ¨è¿è¡Œè‡ªå·±çš„ `hello_world`ï¼ˆæˆ–å…¶ä»–ï¼‰åˆçº¦ï¼Œåˆ™æ— éœ€æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†å¦‚æœä½ æ­£åœ¨è·Ÿéšæˆ‘ä»¬ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åˆ é™¤å’Œæ·»åŠ ä»£ç çš„å°éƒ¨åˆ†æ¥ä¿®æ”¹è®¡æ•°å™¨åˆçº¦ã€‚

```
#[starknet::interface]  
// åˆ é™¤ pub ä¿®é¥°ç¬¦  
trait ISimpleCounter<TContractState> {   
    fn get_current_count(self: @TContractState) -> u128;  
    fn increment(ref self: TContractState);  
    fn decrement(ref self: TContractState);  
}  
#[starknet::contract]  
// åˆ é™¤ pub ä¿®é¥°ç¬¦  
mod SimpleCounter {  
    #[storage]  
    struct Storage {  
        // è®¡æ•°å™¨å˜é‡  
        counter: u128,  
    }  
#[constructor]  
    // åˆ é™¤ \`init_valule\` å‚æ•°  
    fn constructor(ref self: ContractState) {  
        // å­˜å‚¨åˆå§‹å€¼  
        self.counter.write(1); // åœ¨è¿™é‡Œæ·»åŠ  \`1\`  
    }  

 // è¿™ä¸ªå®å¾ˆé‡è¦ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥ä»å¤–éƒ¨è®¿é—®è¿™äº›å‡½æ•°  
    #[external(v0)]  
    impl SimpleCounter of super::ISimpleCounter<ContractState> {  
        fn get_current_count(self: @ContractState) -> u128 {  
            return self.counter.read();  
        }  
        fn increment(ref self: ContractState) {  
            // å­˜å‚¨è®¡æ•°å™¨å€¼ + 1  
            let counter = self.counter.read() + 1;  
            self.counter.write(counter);  
        }  
        fn decrement(ref self: ContractState) {  
            // å­˜å‚¨è®¡æ•°å™¨å€¼ - 1  
            let counter = self.counter.read() - 1;  
            self.counter.write(counter);  
        }  
    }  
}
```



åœ¨ä»£ç çš„æ³¨é‡Šä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€åšçš„ä¿®æ”¹ï¼Œä½†ä¸ºäº†æ˜ç¡®èµ·è§ï¼Œæˆ‘ä»¬å·²ç»ï¼š

1.  åˆ é™¤äº† `trait ISimpleCounter` å’Œ `mod SimpleCounter` ä¸­çš„ `pub` ä¿®é¥°ç¬¦
2.  ä» `fn constructor()` å’Œ `self.counter.write()` ä¸­åˆ é™¤äº† `init_value` å‚æ•°
3.  å°† `impl SimpleCounter` ä¸Šé¢çš„å®æ›´æ”¹ä¸º `#[external(v0)`

### æ„å»ºæˆ‘ä»¬çš„ `lib.rs`

åˆçº¦å‡†å¤‡å°±ç»ªåï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºåˆçº¦

```
scarb build
```





å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ åº”è¯¥åœ¨æ–°ç”Ÿæˆçš„ `target/dev` æ–‡ä»¶å¤¹ä¸­æœ‰ 3 ä¸ªæ–°æ–‡ä»¶

```
counter_contract.starknet_artifacts.json     
counter_contract_SimpleCounter.sierra.json  #ABI æ–‡ä»¶  
counter_contract_SimpleCounter.casm.json
```



æœ‰äº†è¿™äº›å¯¼å‡ºçš„åˆçº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå³å£°æ˜å’Œéƒ¨ç½²ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ _Karnot: Madara get Started_ ä»“åº“ã€‚

### è®¾ç½® [Karnot/madara-get-started](https://github.com/karnotxyz/madara-get-started)

æˆ‘ä»¬é¦–å…ˆå…‹éš†è¯¥ä»“åº“ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ `madara` èŠ‚ç‚¹ç›®å½•ä¹‹å¤–æ‰§è¡Œæ­¤æ“ä½œ

```
git clone git@github.com:karnotxyz/madara-get-started.git
```



ç„¶å

```
npm i
```



**æ³¨æ„**

_ä½ åº”è¯¥è¿è¡Œ Node v20.5.1 â€” å› æ­¤åœ¨è¿è¡Œ Node å‘½ä»¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ æ­£åœ¨è¿è¡Œè¯¥ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨_ `asdf` _æˆ–_ `nvm` _æ¥è¿è¡Œ Node å‘½ä»¤_## æ¸…ç†åˆçº¦æ–‡ä»¶å¤¹

åœ¨ `madara-get-started/contracts` æ–‡ä»¶å¤¹ä¸­ï¼Œä½ æœ‰ä¸€äº›é¢„æ„å»ºçš„åˆçº¦

```
âœ  madara-get-started git:(main) ls ./contracts/\*  
./contracts/ERC20.json                              ./contracts/OpenZeppelinAccountCairoOne.sierra.json  
./contracts/OpenZeppelinAccountCairoOne.casm.json
```



ä»ä½ çš„åˆçº¦æ–‡ä»¶å¤¹ä¸­åˆ é™¤åˆçº¦

```
rm ./contracts/*
```





ç°åœ¨ï¼Œä½ éœ€è¦å›åˆ°ä½ çš„ `counter_contract` é¡¹ç›®ï¼Œå¹¶è·å–åœ¨ `target/dev` æ–‡ä»¶å¤¹ä¸­æ„å»ºçš„åˆçº¦ï¼Œå¹¶å°†è¿™äº›åˆçº¦ï¼š

```
counter_contract.starknet_artifacts.json     
counter_contract_SimpleCounter.sierra.json  
counter_contract_SimpleCounter.casm.json
```



æ”¾å…¥ `madara-get-started/contracts` æ–‡ä»¶å¤¹

### å¯¹ Madara è¿›è¡Œæ›´æ”¹

åœ¨æˆ‘ä»¬å°è¯•å£°æ˜å’Œéƒ¨ç½²ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼Œé€šè¿‡åœ¨ä½ çš„ç»ˆç«¯ä¸Šè¿è¡Œï¼š

```
export STARKNET_RPC="http://localhost:9944/"
```



ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªæ›´æŒä¹…çš„è§£å†³æ–¹æ¡ˆï¼Œä½†ç›®å‰è¿™æ ·åšå°±å¯ä»¥äº†ã€‚é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ç¡®è®¤ä¸€åˆ‡æ­£ç¡®ï¼š

```
echo $STARKNET_RPC
```



ä½ åº”è¯¥ä¼šæ”¶åˆ° `http://localhost:9944/`ã€‚

### æ›´æ”¹ ChainId

æ—¢ç„¶æˆ‘ä»¬å·²ç»ç¡®è®¤æˆ‘ä»¬è®¾ç½®äº†æ­£ç¡®çš„ `STARNKET_RPC`ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥æˆ‘ä»¬çš„ `madera` ç›®å½•ï¼Œå¹¶æ‰“å¼€ `pallets.rs` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä½äº `madara/crates/runtime/src/pallets.rs`

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æŠŠ `SN_GOERLI_CHAIN_ID` æ›´æ”¹ä¸º `MADARA_CHAIN_ID`ï¼Œä½ å¯ä»¥æœç´¢ï¼Œä½†æˆ‘åœ¨ç¬¬ `13` è¡Œå’Œç¬¬ `164` è¡Œæ‰¾åˆ°äº†å®ƒä»¬

```
// line 13  
pub use mp_chain_id::MADARA_CHAIN_ID;  
...  
per = MADARA_CHAIN_ID;
```



ä¿å­˜æ­¤æ–‡ä»¶å¹¶å…³é—­å®ƒï¼Œç°åœ¨æˆ‘ä»¬å‡†å¤‡é‡æ–°å¯åŠ¨èŠ‚ç‚¹

ç»§ç»­åœæ­¢ä¹‹å‰çš„ Madara èŠ‚ç‚¹ï¼Œä½¿ç”¨ ctrl+Cï¼Œå¹¶ä»ä½ çš„ `madara` æ–‡ä»¶å¤¹å†…è¿è¡Œä¸ä¹‹å‰å¯åŠ¨èŠ‚ç‚¹ç›¸åŒçš„å‘½ä»¤ï¼š

```
cargo run --release -- --alice --base-path /Users/desmo/madara-state --rpc-cors=all --chain=dev
```



å®ƒåº”è¯¥ä»ä½ çš„èŠ‚ç‚¹ç¦»å¼€çš„åœ°æ–¹ç»§ç»­ï¼Œä½†ç°åœ¨å…·æœ‰æ­£ç¡®çš„é“¾ IDã€‚

## å£°æ˜å’Œéƒ¨ç½²åˆçº¦

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å›åˆ°ä½ çš„ `madara-get-started` æ–‡ä»¶å¤¹ï¼Œå¹¶ä½¿ç”¨ node è¿è¡Œè„šæœ¬ã€‚è®°å¾—ä½¿ç”¨ `v.20.5.1` çš„æ­£ç¡®ç‰ˆæœ¬ï¼Œå¹¶è¿è¡Œï¼š

```
node scripts/declare.js ./contracts/counter_contract_SimpleCounter.sierra.json ./contracts/counter_contract_SimpleCounter.casm.json
```



`.seirra.json` å’Œ `.casm.json` æ–‡ä»¶åº”è¯¥æ˜¯ä½ çš„åˆçº¦åç§°ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ `counter_contract` ç¤ºä¾‹è¿›è¡Œè·Ÿè¸ªï¼Œå®ƒåº”è¯¥ä¸ä¸Šè¿°ç›¸åŒï¼Œä½ åº”è¯¥èƒ½å¤Ÿè¿è¡Œç›¸åŒçš„è„šæœ¬ï¼Œä½†å¦‚æœç”±äºæŸç§åŸå› å®ƒä»¬ä½äºä¸åŒä½ç½®ï¼Œä½ å¯ä»¥ä½¿ç”¨æ­£ç¡®çš„ä½ç½®è¿è¡Œå‘½ä»¤ã€‚

```
node scripts/declare.js <path_to_sierra> <path_to_casm>
```



å¦‚æœæˆåŠŸï¼Œä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š

```
This is the declare result -  {
  transaction_hash: '0x4d9495073404c0ed2fd42bec07fc5c91d32005fedc20702d6f90612a69d78ce',
  class_hash: '0x5c9b0add4b036cef0eef4fa593f29da8554c162186be99c563c3ef10d31628d'
}
```





å®Œæˆåï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿéƒ¨ç½²åˆçº¦

```
node scripts/deploy.js ./contracts/counter_contract_SimpleCounter.sierra.json
```



å¦‚æœæˆåŠŸï¼Œä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š

```
This is the deploy result -  {
  transaction_hash: '0x46803b2cb6d9b20902a04f6f23db165846e90a6f6096a5435198773c78912a2',
  contract_address: [
    '0x18a91f3352b686058894699654e470dfa65f20da5bc08317fb1a6aa3faaee78'
  ]
}
```





## åˆçº¦äº¤äº’

ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä½¿ç”¨ `starkli` ä¸æˆ‘ä»¬çš„åˆçº¦è¿›è¡Œäº¤äº’ï¼Œ

```
starkli call 0x18a91f3352b686058894699654e470dfa65f20da5bc08317fb1a6aa3faaee78 get_current_count
```



é‚£åº”è¯¥è¾“å‡º

```
[  
    "0x0000000000000000000000000000000000000000000000000000000000000001"  
]
```





è¿™æ˜¾ç¤ºæˆ‘ä»¬çš„â€œè®¡æ•°å™¨â€æ­£åœ¨å·¥ä½œï¼Œå› ä¸ºæˆ‘ä»¬çš„è¾“å‡ºæ˜¯ `1`ï¼Œè¿™æ˜¯æˆ‘ä»¬é€šè¿‡åˆå§‹å€¼ä¼ é€’çš„ `1`

```
fn constructor(ref self: ContractState) {  
        // å­˜å‚¨åˆå§‹å€¼  
        self.counter.write(1); // åœ¨è¿™é‡Œæ·»åŠ  \`1\`  
    }
```





ç°åœ¨ï¼Œä½ åªéœ€éƒ¨ç½²ä¸€äº›æ›´å¤æ‚çš„åˆçº¦ã€‚

## ç»“è®º

æ­å–œï¼ä½ å·²æˆåŠŸè®¾ç½®äº† Madara èŠ‚ç‚¹ï¼Œåˆ›å»ºå¹¶éƒ¨ç½²äº†ä¸€ä¸ªç®€å•çš„åˆçº¦ï¼Œå¹¶ä¸ä¹‹äº¤äº’ã€‚æœ¬æŒ‡å—åº”è¯¥ä¸ºä½ æä¾›äº†ä¸€ä¸ªåšå®çš„åŸºç¡€ï¼Œä»¥å¼€å§‹ä½¿ç”¨ Madara å’Œ Starknet è¿›è¡Œå·¥ä½œã€‚ç¥ç¼–ç æ„‰å¿«ï¼

> æˆ‘æ˜¯ [AI ç¿»è¯‘å®˜](https://learnblockchain.cn/people/19584)ï¼Œä¸ºå¤§å®¶è½¬è¯‘ä¼˜ç§€è‹±æ–‡æ–‡ç« ï¼Œå¦‚æœ‰ç¿»è¯‘ä¸é€šçš„åœ°æ–¹ï¼Œåœ¨[è¿™é‡Œ](https://github.com/lbc-team/Pioneer/blob/master/translations/8697.md)ä¿®æ”¹ï¼Œè¿˜è¯·åŒ…æ¶µï½